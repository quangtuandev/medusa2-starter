import{c as O,u as V,F as b,a as A,i as B,f as I}from"./prices-DMHxn0dT.js";import{r as s,j as c,h as H}from"./chunk-OIYGIGL5-lvf-TMgM.js";import{m as w}from"./Image-D0dBiRb2.js";var h=(e=>(e.cart="cart",e.login="login",e.search="search",e))(h||{}),D=(e=>(e.toggle="toggle",e.set="set",e))(D||{});const F=s.createContext(null),K={set:(e,{target:t,state:n})=>({...e,[t]:w({},e[t],n)}),toggle:(e,{target:t,open:n,state:o})=>({...e,[t]:w({},e[t],o,{open:n??!e[t].open})})},q=O({actionHandlers:K}),z={cart:{},login:{},search:{}},X=({data:e,...t})=>{const[n,o]=s.useReducer(q,z);return c.jsx(F.Provider,{value:{state:w({},n,e),dispatch:o},...t})},x=(e,t)=>typeof t=="boolean"?{name:D.toggle,payload:{open:t,target:e}}:{name:D.toggle,payload:{...t,target:e}},G=({dispatch:e})=>({toggleCartDrawer:t=>e(x(h.cart,t)),toggleLoginModal:t=>e(x(h.login,t)),toggleSearchDrawer:t=>e(x(h.search,t))}),J=()=>{const e=s.useContext(F);if(!e)throw new Error("useStorefront must be used within a StorefrontContext.Provider");return{...e,actions:G(e)}},Y=()=>{var P,j,y,E,L;const{state:e,actions:t}=J(),n=V(),o=H(),[a,g]=s.useState(!1),f=s.useRef(null),C=s.useRef(0),i={removing:o.find(r=>{var m;return(r.state==="submitting"||r.state==="loading")&&r.key===b.cart.removeLineItem&&((m=r.formData)==null?void 0:m.get("lineItemId"))}),adding:o.filter(r=>{var m;return r.key===b.cart.createLineItem&&(r.state==="submitting"||r.state==="loading")&&((m=r.formData)==null?void 0:m.has("variantId"))})},d=n==null?void 0:n.cart,R=(d==null?void 0:d.items)||[],l=R.length;i.removing&&console.log("removing",(j=(P=i.removing)==null?void 0:P.formData)==null?void 0:j.get("lineItemId"));const p=i.adding.length>0,v=(E=(y=i.removing)==null?void 0:y.formData)==null?void 0:E.get("lineItemId"),S=v&&(l===1&&v===((L=R[0])==null?void 0:L.id)||l===0&&C.current===1&&i.removing),u=s.useCallback(()=>{f.current!==null&&(window.clearTimeout(f.current),f.current=null)},[]),k=s.useCallback(r=>{r!==!!e.cart.open&&(t.toggleCartDrawer(r),r||g(!1))},[t,e.cart.open]);s.useEffect(()=>{u();const r=!!e.cart.open;return S&&!a&&(g(!0),r&&(f.current=window.setTimeout(()=>{t.toggleCartDrawer(!1),g(!1)},1500))),C.current=l,u},[e.cart.open,l,S,a,t,u]),s.useEffect(()=>{(!e.cart.open||p)&&g(!1)},[e.cart.open,p]),s.useEffect(()=>u,[u]);const M=!p&&l===0&&!a,N=e.cart.open===!0;return{cart:d,isAddingItem:p,isRemovingItemId:v,isRemovingLastItem:a,cartDrawerOpen:N,toggleCartDrawer:k,showEmptyCartMessage:M}},Z=({variant:e,currencyCode:t})=>{const{original:n,calculated:o}=A(e),a=B(o)&&o<(n??0);return c.jsx(c.Fragment,{children:a?c.jsxs("span",{className:"inline-flex items-center gap-1",children:[c.jsx("span",{children:I(o,{currency:t})}),c.jsx("s",{className:"text-gray-400",children:I(n||0,{currency:t})})]}):I(n||0,{currency:t})})};export{Z as P,X as S,z as s,Y as u};
