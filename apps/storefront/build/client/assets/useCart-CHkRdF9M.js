import{c as M,u as O,F as y}from"./useRegion-FpaqUcQ9.js";import{r as o,j as A,b as B}from"./chunk-OIYGIGL5-CeQP4D0V.js";import{m as h}from"./Image-CbYvfYa3.js";var p=(e=>(e.cart="cart",e.login="login",e.search="search",e))(p||{}),w=(e=>(e.toggle="toggle",e.set="set",e))(w||{});const k=o.createContext(null),H={set:(e,{target:t,state:n})=>({...e,[t]:h({},e[t],n)}),toggle:(e,{target:t,open:n,state:s})=>({...e,[t]:h({},e[t],s,{open:n??!e[t].open})})},K=M({actionHandlers:H}),q={cart:{},login:{},search:{}},V=({data:e,...t})=>{const[n,s]=o.useReducer(K,q);return A.jsx(k.Provider,{value:{state:h({},n,e),dispatch:s},...t})},I=(e,t)=>typeof t=="boolean"?{name:w.toggle,payload:{open:t,target:e}}:{name:w.toggle,payload:{...t,target:e}},z=({dispatch:e})=>({toggleCartDrawer:t=>e(I(p.cart,t)),toggleLoginModal:t=>e(I(p.login,t)),toggleSearchDrawer:t=>e(I(p.search,t))}),G=()=>{const e=o.useContext(k);if(!e)throw new Error("useStorefront must be used within a StorefrontContext.Provider");return{...e,actions:z(e)}},W=()=>{var x,S,E,L,b;const{state:e,actions:t}=G(),n=O(),s=B(),[l,m]=o.useState(!1),g=o.useRef(null),C=o.useRef(0),a={removing:s.find(r=>{var u;return(r.state==="submitting"||r.state==="loading")&&r.key===y.cart.removeLineItem&&((u=r.formData)==null?void 0:u.get("lineItemId"))}),adding:s.filter(r=>{var u;return r.key===y.cart.createLineItem&&(r.state==="submitting"||r.state==="loading")&&((u=r.formData)==null?void 0:u.has("variantId"))})},f=n==null?void 0:n.cart,D=(f==null?void 0:f.items)||[],c=D.length;a.removing&&console.log("removing",(S=(x=a.removing)==null?void 0:x.formData)==null?void 0:S.get("lineItemId"));const d=a.adding.length>0,v=(L=(E=a.removing)==null?void 0:E.formData)==null?void 0:L.get("lineItemId"),R=v&&(c===1&&v===((b=D[0])==null?void 0:b.id)||c===0&&C.current===1&&a.removing),i=o.useCallback(()=>{g.current!==null&&(window.clearTimeout(g.current),g.current=null)},[]),F=o.useCallback(r=>{r!==!!e.cart.open&&(t.toggleCartDrawer(r),r||m(!1))},[t,e.cart.open]);o.useEffect(()=>{i();const r=!!e.cart.open;return R&&!l&&(m(!0),r&&(g.current=window.setTimeout(()=>{t.toggleCartDrawer(!1),m(!1)},1500))),C.current=c,i},[e.cart.open,c,R,l,t,i]),o.useEffect(()=>{(!e.cart.open||d)&&m(!1)},[e.cart.open,d]),o.useEffect(()=>i,[i]);const j=!d&&c===0&&!l,P=e.cart.open===!0;return{cart:f,isAddingItem:d,isRemovingItemId:v,isRemovingLastItem:l,cartDrawerOpen:P,toggleCartDrawer:F,showEmptyCartMessage:j}};export{V as S,q as s,W as u};
