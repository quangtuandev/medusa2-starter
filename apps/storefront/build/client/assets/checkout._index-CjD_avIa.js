import{j as n,r as g,b as Bt,g as Ut,R as S,d as ee,L as dt,a as $t,w as Wt,u as Yt}from"./chunk-OIYGIGL5-hjFmARwk.js";import{b as Gt,h as Kt,x as zt,D as Ht,M as Jt,a as H,F as Te,A as Qt,f as Xt,c as Zt,m as en,d as ve}from"./data-table-router-form-UNsgamxU.js";import{u as ut,c as tn,b as nn,a as rn,F as be}from"./useRegion-jtrSPBfO.js";import{a as le}from"./Button-UBLltX1-.js";import{c as U}from"./clsx-B-dksMZM.js";import{u as sn,a as on,F as an,b as cn}from"./ShoppingCartIcon-DTucv7RM.js";import{o as z,b as ln,s as x,d as we,c as Ae,u as pt,e as nt,a as de,t as ue,R as pe,S as Oe,f as dn}from"./SubmitButton-yvheGpFR.js";import{f as je}from"./prices-U96JmiR0.js";import{Q as un,d as oe}from"./QuantitySelector-lyMlpNwp.js";import{I as pn}from"./Image-DelO2kW0.js";import{B as mn}from"./ButtonLink-UCVE-Y4y.js";import"./createLucideIcon-ndLoN6FL.js";import"./index-nVb1vZdu.js";import"./use-is-mounted-KzvcNT4v.js";import"./PlusIcon-c9PtLKzF.js";const ke=(t,e=new FormData,r="")=>t==null?e:typeof t=="object"&&!(t instanceof Date)&&!(t instanceof File)?(Object.entries(t).forEach(([s,i])=>{ke(i,e,r?t[s]instanceof File?r:`${r}.${s}`:s)}),e):Array.isArray(t)?(t.forEach((s,i)=>{ke(s,e,`${r}.${i}`)}),e):(e.append(r,t),e),hn=z({cartId:x(),shippingOptionIds:ln(x())}),fn=z({cartId:x(),customerId:x().optional(),email:x().email("Please enter a valid email"),shippingAddress:z({firstName:x().min(1,"First name is required"),lastName:x().min(1,"Last name is required"),company:x().optional(),address1:x().min(1,"Address is required"),address2:x().optional(),city:x().min(1,"City is required"),province:x().min(1,"Province is required"),countryCode:x().min(1,"Country is required"),postalCode:x().min(1,"Postal code is required"),phone:x().optional()}),shippingAddressId:x(),isExpressCheckout:we().optional()}),gn=z({lineItemId:x().min(1,"Line item ID is required"),quantity:Ae.number().int()}),yn=z({cartId:x(),code:x().min(1,"Discount code is required")});function xn(t){const{control:e}=pt(),{components:r,...s}=t,i={FormDescription:Jt,FormControl:Ht,FormLabel:zt,FormMessage:Kt,...r};return n.jsx(Gt,{control:e,components:i,...s})}const Pe={firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",province:"",postalCode:"",countryCode:"",phone:""},Me=t=>t?{...Pe,firstName:(t==null?void 0:t.first_name)||"",lastName:(t==null?void 0:t.last_name)||"",company:(t==null?void 0:t.company)||"",address1:(t==null?void 0:t.address_1)||"",address2:(t==null?void 0:t.address_2)||"",city:(t==null?void 0:t.city)||"",countryCode:(t==null?void 0:t.country_code)||"",phone:(t==null?void 0:t.phone)||"",postalCode:(t==null?void 0:t.postal_code)||"",province:(t==null?void 0:t.province)||""}:Pe,De=t=>{const e=t.reduce((r,s)=>{const i=s.shipping_profile_id;return i&&(r[i]||(r[i]=[]),r[i].push(s)),r},{});return Object.keys(e).forEach(r=>e[r].sort((s,i)=>(s.amount||0)-(i.amount||0))),e},vn=(t,e)=>!!t.email||!!(e!=null&&e.email),Le=t=>{var e;return!!((e=t.shipping_address)!=null&&e.address_1)},bn=(t,e)=>{var i;const r=((i=t.shipping_methods)==null?void 0:i.map(o=>o.shipping_option_id))||[],s=De(e);return Object.values(s).every(o=>o.find(c=>r.includes(c.id)))};function jn(t){if((t==null?void 0:t.length)<1)return 0;const e=De(t);return Object.values(e).reduce((r,s)=>{const i=s.reduce((o,c)=>(o.amount||0)<((c==null?void 0:c.amount)||0)?o:c);return r+(i.amount||0)},0)}const Cn=z({firstName:x().min(1,"First name is required").optional(),lastName:x().min(1,"Last name is required").optional(),company:x().optional(),address1:x().min(1,"Address is required").optional(),address2:x().optional(),city:x().min(1,"City is required").optional(),province:x().min(1,"Province is required").optional(),countryCode:x().min(1,"Country is required"),postalCode:x().min(1,"Postal code is required"),phone:x().optional()}),Sn=z({cartId:x(),providerId:x(),paymentMethodId:x(),sameAsShipping:we().optional(),billingAddress:nt(),noRedirect:we().optional()}).refine(t=>t.sameAsShipping?nt():Cn.safeParse(t.billingAddress).success,{message:"Valid billing address is required when creating a new address",path:["root"]}),qe=()=>{const t=ut();return{customer:t==null?void 0:t.customer}};var J=(t=>(t.CONTACT_INFO="contactInfo",t.ACCOUNT_DETAILS="accountDetails",t.PAYMENT="payment",t.SUCCESS="success",t))(J||{});const mt=t=>{const{cart:e}=t,{customer:r}=qe(),s=!!(r!=null&&r.id),i=g.useMemo(()=>vn(e,r),[e,r]),o=g.useMemo(()=>Le(e),[e,s]);let c="accountDetails";return i&&(c="accountDetails"),o&&(c="payment"),c},ht=g.createContext(null),_n={setStep:(t,e)=>({...t,step:e})},Nn=tn({actionHandlers:_n}),En=({data:t,...e})=>{const s={step:mt({...t}),cart:null,shippingOptions:[],paymentProviders:[],activePaymentSession:null},[i,o]=g.useReducer(Nn,s);return n.jsx(ht.Provider,{value:{state:{...i,...t},dispatch:o},...e})},wn=({dispatch:t})=>({setStep:e=>t({name:"setStep",payload:e})}),L=()=>{const t=g.useContext(ht),e=mt(t.state),{state:r}=t,i=Bt().filter(o=>o.key.startsWith(nn));if(!r.step)throw new Error("useCheckout must be used within a CheckoutProvider");return{...r,...wn(t),goToNextStep:()=>t.dispatch({name:"setStep",payload:e}),isCartMutating:i.some(o=>["loading","submitting"].includes(o.state))}},Ie=({className:t,name:e,...r})=>n.jsx(H,{...r,className:U("[&_input]:!h-12 [&_input]:border-gray-200 [&_input]:!bg-white [&_input]:text-[16px] [&_input]:shadow-sm [&_input]:!ring-0","[&_input:-webkit-autofill]:!transition-[background-color_5000s_ease-in-out_0s]","[&_input:-webkit-autofill]:!shadow-[0_0_0_1000px_white_inset]","[&_label]:text-[16px] [&_label]:text-gray-600",t),name:e});function An({title:t,titleId:e,...r},s){return g.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":e},r),t?g.createElement("title",{id:e},t):null,g.createElement("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z",clipRule:"evenodd"}))}const kn=g.forwardRef(An),ft=({completed:t,setStep:e,step:r,children:s})=>n.jsxs("header",{className:"relative flex items-center justify-between",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s}),t&&n.jsxs(n.Fragment,{children:[n.jsx(le,{className:"text-sm",variant:"link",onClick:()=>e(r),children:"Edit"}),n.jsx("span",{className:"absolute -left-10 mt-0.5 hidden h-6 w-6 items-center justify-center rounded-full bg-green-100 text-green-700 md:flex",children:n.jsx(kn,{className:"h-4 w-4"})})]})]}),gt=({address:t,prefix:e})=>n.jsx(n.Fragment,{children:Object.keys(t).map(r=>{const s=r;if(t[s]!=null)return n.jsx(H,{type:"hidden",name:`${e}.${r}`,value:t[s]??""},s)})}),Ve=()=>{const t=ut();if(!(t!=null&&t.env))throw new Error("No env data found, this should be provided in the root loader");return{env:t==null?void 0:t.env}};var yt={exports:{}},Pn="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",In=Pn,Rn=In;function xt(){}function vt(){}vt.resetWarningCache=xt;var Fn=function(){function t(s,i,o,c,d,a){if(a!==Rn){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:vt,resetWarningCache:xt};return r.PropTypes=r,r};yt.exports=Fn();var Tn=yt.exports;const E=Ut(Tn);function rt(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),r.push.apply(r,s)}return r}function st(t){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?rt(Object(r),!0).forEach(function(s){bt(t,s,r[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):rt(Object(r)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(r,s))})}return t}function ye(t){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ye=function(e){return typeof e}:ye=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(t)}function bt(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function jt(t,e){return On(t)||Mn(t,e)||Dn(t,e)||Ln()}function On(t){if(Array.isArray(t))return t}function Mn(t,e){var r=t&&(typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"]);if(r!=null){var s=[],i=!0,o=!1,c,d;try{for(r=r.call(t);!(i=(c=r.next()).done)&&(s.push(c.value),!(e&&s.length===e));i=!0);}catch(a){o=!0,d=a}finally{try{!i&&r.return!=null&&r.return()}finally{if(o)throw d}}return s}}function Dn(t,e){if(t){if(typeof t=="string")return it(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);if(r==="Object"&&t.constructor&&(r=t.constructor.name),r==="Map"||r==="Set")return Array.from(t);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return it(t,e)}}function it(t,e){(e==null||e>t.length)&&(e=t.length);for(var r=0,s=new Array(e);r<e;r++)s[r]=t[r];return s}function Ln(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var V=function(e,r,s){var i=!!s,o=S.useRef(s);S.useEffect(function(){o.current=s},[s]),S.useEffect(function(){if(!i||!e)return function(){};var c=function(){o.current&&o.current.apply(o,arguments)};return e.on(r,c),function(){e.off(r,c)}},[i,r,e,o])},Re=function(e){var r=S.useRef(e);return S.useEffect(function(){r.current=e},[e]),r.current},Z=function(e){return e!==null&&ye(e)==="object"},qn=function(e){return Z(e)&&typeof e.then=="function"},Vn=function(e){return Z(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ot="[object Object]",Bn=function t(e,r){if(!Z(e)||!Z(r))return e===r;var s=Array.isArray(e),i=Array.isArray(r);if(s!==i)return!1;var o=Object.prototype.toString.call(e)===ot,c=Object.prototype.toString.call(r)===ot;if(o!==c)return!1;if(!o&&!s)return e===r;var d=Object.keys(e),a=Object.keys(r);if(d.length!==a.length)return!1;for(var u={},m=0;m<d.length;m+=1)u[d[m]]=!0;for(var p=0;p<a.length;p+=1)u[a[p]]=!0;var y=Object.keys(u);if(y.length!==d.length)return!1;var w=e,v=r,_=function(f){return t(w[f],v[f])};return y.every(_)},Ct=function(e,r,s){return Z(e)?Object.keys(e).reduce(function(i,o){var c=!Z(r)||!Bn(e[o],r[o]);return s.includes(o)?(c&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),i):c?st(st({},i||{}),{},bt({},o,e[o])):i},null):null},St="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",at=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:St;if(e===null||Vn(e))return e;throw new Error(r)},Un=function(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:St;if(qn(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(i){return at(i,r)})};var s=at(e,r);return s===null?{tag:"empty"}:{tag:"sync",stripe:s}},$n=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"2.7.3"}),e.registerAppInfo({name:"react-stripe-js",version:"2.7.3",url:"https://stripe.com/docs/stripe-js/react"}))},Ce=S.createContext(null);Ce.displayName="ElementsContext";var _t=function(e,r){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(r," in an <Elements> provider."));return e},Be=function(e){var r=e.stripe,s=e.options,i=e.children,o=S.useMemo(function(){return Un(r)},[r]),c=S.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(s):null}}),d=jt(c,2),a=d[0],u=d[1];S.useEffect(function(){var y=!0,w=function(_){u(function(A){return A.stripe?A:{stripe:_,elements:_.elements(s)}})};return o.tag==="async"&&!a.stripe?o.stripePromise.then(function(v){v&&y&&w(v)}):o.tag==="sync"&&!a.stripe&&w(o.stripe),function(){y=!1}},[o,a,s]);var m=Re(r);S.useEffect(function(){m!==null&&m!==r&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[m,r]);var p=Re(s);return S.useEffect(function(){if(a.elements){var y=Ct(s,p,["clientSecret","fonts"]);y&&a.elements.update(y)}},[s,p,a.elements]),S.useEffect(function(){$n(a.stripe)},[a.stripe]),S.createElement(Ce.Provider,{value:a},i)};Be.propTypes={stripe:E.any,options:E.object};var Wn=function(e){var r=S.useContext(Ce);return _t(r,e)},Nt=function(){var e=Wn("calls useElements()"),r=e.elements;return r};E.func.isRequired;var Et=S.createContext(null);Et.displayName="CustomCheckoutSdkContext";var Yn=function(e,r){if(!e)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(r," in an <CustomCheckoutProvider> provider."));return e},Gn=S.createContext(null);Gn.displayName="CustomCheckoutContext";E.any,E.shape({clientSecret:E.string.isRequired,elementsOptions:E.object}).isRequired;var Fe=function(e){var r=S.useContext(Et),s=S.useContext(Ce);if(r&&s)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CustomCheckoutProvider> and <Elements> providers."));return r?Yn(r,e):_t(s,e)},Kn=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},I=function(e,r){var s="".concat(Kn(e),"Element"),i=function(a){var u=a.id,m=a.className,p=a.options,y=p===void 0?{}:p,w=a.onBlur,v=a.onFocus,_=a.onReady,A=a.onChange,f=a.onEscape,q=a.onClick,O=a.onLoadError,F=a.onLoaderStart,h=a.onNetworksChange,l=a.onConfirm,j=a.onCancel,N=a.onShippingAddressChange,b=a.onShippingRateChange,k=Fe("mounts <".concat(s,">")),M="elements"in k?k.elements:null,D="customCheckoutSdk"in k?k.customCheckoutSdk:null,C=S.useState(null),$=jt(C,2),P=$[0],Q=$[1],B=S.useRef(null),G=S.useRef(null);V(P,"blur",w),V(P,"focus",v),V(P,"escape",f),V(P,"click",q),V(P,"loaderror",O),V(P,"loaderstart",F),V(P,"networkschange",h),V(P,"confirm",l),V(P,"cancel",j),V(P,"shippingaddresschange",N),V(P,"shippingratechange",b),V(P,"change",A);var W;_&&(e==="expressCheckout"?W=_:W=function(){_(P)}),V(P,"ready",W),S.useLayoutEffect(function(){if(B.current===null&&G.current!==null&&(M||D)){var T=null;D?T=D.createElement(e,y):M&&(T=M.create(e,y)),B.current=T,Q(T),T&&T.mount(G.current)}},[M,D,y]);var K=Re(y);return S.useEffect(function(){if(B.current){var T=Ct(y,K,["paymentRequest"]);T&&B.current.update(T)}},[y,K]),S.useLayoutEffect(function(){return function(){if(B.current&&typeof B.current.destroy=="function")try{B.current.destroy(),B.current=null}catch{}}},[]),S.createElement("div",{id:u,className:m,ref:G})},o=function(a){Fe("mounts <".concat(s,">"));var u=a.id,m=a.className;return S.createElement("div",{id:u,className:m})},c=r?o:i;return c.propTypes={id:E.string,className:E.string,onChange:E.func,onBlur:E.func,onFocus:E.func,onReady:E.func,onEscape:E.func,onClick:E.func,onLoadError:E.func,onLoaderStart:E.func,onNetworksChange:E.func,onConfirm:E.func,onCancel:E.func,onShippingAddressChange:E.func,onShippingRateChange:E.func,options:E.object},c.displayName=s,c.__elementType=e,c},R=typeof window>"u",zn=S.createContext(null);zn.displayName="EmbeddedCheckoutProviderContext";var wt=function(){var e=Fe("calls useStripe()"),r=e.stripe;return r};I("auBankAccount",R);I("card",R);I("cardNumber",R);I("cardExpiry",R);I("cardCvc",R);I("fpxBank",R);I("iban",R);I("idealBank",R);I("p24Bank",R);I("epsBank",R);var Hn=I("payment",R),Jn=I("expressCheckout",R);I("paymentRequestButton",R);I("linkAuthentication",R);var Qn=I("address",R);I("shippingAddress",R);I("paymentMethodMessaging",R);I("affirmMessage",R);I("afterpayClearpayMessage",R);var At="https://js.stripe.com/v3",Xn=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var Zn=function(){for(var e=document.querySelectorAll('script[src^="'.concat(At,'"]')),r=0;r<e.length;r++){var s=e[r];if(Xn.test(s.src))return s}return null},ct=function(e){var r="",s=document.createElement("script");s.src="".concat(At).concat(r);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(s),s},er=function(e,r){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:r})},ae=null,he=null,fe=null,tr=function(e){return function(){e(new Error("Failed to load Stripe.js"))}},nr=function(e,r){return function(){window.Stripe?e(window.Stripe):r(new Error("Stripe.js not available"))}},rr=function(e){return ae!==null?ae:(ae=new Promise(function(r,s){if(typeof window>"u"||typeof document>"u"){r(null);return}if(window.Stripe){r(window.Stripe);return}try{var i=Zn();if(!(i&&e)){if(!i)i=ct(e);else if(i&&fe!==null&&he!==null){var o;i.removeEventListener("load",fe),i.removeEventListener("error",he),(o=i.parentNode)===null||o===void 0||o.removeChild(i),i=ct(e)}}fe=nr(r,s),he=tr(s),i.addEventListener("load",fe),i.addEventListener("error",he)}catch(c){s(c);return}}),ae.catch(function(r){return ae=null,Promise.reject(r)}))},sr=function(e,r,s){if(e===null)return null;var i=e.apply(void 0,r);return er(i,s),i},ce,kt=!1,Pt=function(){return ce||(ce=rr(null).catch(function(e){return ce=null,Promise.reject(e)}),ce)};Promise.resolve().then(function(){return Pt()}).catch(function(t){kt||console.warn(t)});var It=function(){for(var e=arguments.length,r=new Array(e),s=0;s<e;s++)r[s]=arguments[s];kt=!0;var i=Date.now();return Pt().then(function(o){return sr(o,r,i)})};const ir=t=>({address:{firstName:(t==null?void 0:t.first_name)||"",lastName:(t==null?void 0:t.last_name)||"",address1:(t==null?void 0:t.address_1)||"",address2:(t==null?void 0:t.address_2)||"",province:(t==null?void 0:t.province)||"",city:(t==null?void 0:t.city)||"",countryCode:(t==null?void 0:t.country_code)||"us",postalCode:(t==null?void 0:t.postal_code)||"",phone:(t==null?void 0:t.phone)||""},completed:!1}),Rt=({title:t,address:e,mode:r,allowedCountries:s=[],setAddress:i})=>{var m;const{env:o}=Ve(),{cart:c}=L(),{region:d}=rn(),a=p=>{var A,f;const y=((A=p.value.name)==null?void 0:A.split(" "))||[],w=y.slice(0,-1).join(" "),v=y.slice(-1).join(" "),_=p.complete&&!p.value.address.state;i({address:{firstName:p.value.firstName||w||"",lastName:p.value.lastName||v||"",address1:p.value.address.line1,address2:p.value.address.line2??"",province:_?"-":p.value.address.state,city:p.value.address.city,countryCode:(f=p.value.address.country)==null?void 0:f.toLowerCase(),postalCode:p.value.address.postal_code,phone:p.value.phone??""},completed:p.complete})},u=g.useMemo(()=>o.STRIPE_PUBLIC_KEY?It(o.STRIPE_PUBLIC_KEY):null,[o.STRIPE_PUBLIC_KEY]);return c?n.jsxs("div",{children:[t&&n.jsx("h3",{className:"mt-6 text-sm",children:t}),n.jsx(Be,{stripe:u,options:{mode:"setup",currency:d.currency_code,appearance:{variables:{borderRadius:"6px",spacingUnit:"4.601px",fontSizeBase:"16px",colorText:"#374151",fontWeightNormal:"400",fontWeightBold:"700",fontSizeSm:"16px"},rules:{".Input":{fontSize:"1rem",color:"#000000"},".Input:focus":{boxShadow:"inset 0 0 0 1px rgba(210, 213, 218, 1)"},".Label":{FontWeight:"700"}}}},children:n.jsx(Qn,{options:{mode:r,allowedCountries:s,display:{name:"split"},fields:{phone:"always"},validation:{phone:{required:"always"}},defaultValues:{address:{line1:e.address1,line2:e.address2,city:e.city,state:e.province,postal_code:e.postalCode,country:((m=e.countryCode)==null?void 0:m.toUpperCase())||"us"},phone:e.phone,firstName:e.firstName,lastName:e.lastName}},onChange:a})})]}):null},Ft=({title:t,address:e,countryOptions:r})=>{var s;return n.jsxs("span",{children:[t&&n.jsx("dt",{className:"mt-6 text-sm font-bold text-gray-700",children:t}),n.jsxs("dd",{className:"mt-0.5",children:[(e==null?void 0:e.company)&&n.jsxs(n.Fragment,{children:[e==null?void 0:e.company,n.jsx("br",{})]}),e==null?void 0:e.address1,n.jsx("br",{}),(e==null?void 0:e.address2)&&n.jsxs(n.Fragment,{children:[e==null?void 0:e.address2,n.jsx("br",{})]}),e==null?void 0:e.city,", ",e==null?void 0:e.province," ",e==null?void 0:e.postalCode,n.jsx("br",{}),(e==null?void 0:e.countryCode)&&n.jsxs(n.Fragment,{children:[(s=r.find(({value:i})=>i===(e==null?void 0:e.countryCode)))==null?void 0:s.label,n.jsx("br",{})]})]})]})},or=(t,e)=>{var s,i,o;return t.shipping_address?t.shipping_address:!e||!((s=e==null?void 0:e.addresses)!=null&&s.length)?null:(e!=null&&e.default_shipping_address_id?(i=e.addresses)==null?void 0:i.find(c=>c.id===(e==null?void 0:e.default_shipping_address_id)):(o=e==null?void 0:e.addresses)==null?void 0:o[0])||null},ar="new",cr=()=>{var l,j,N;const t=ee({key:be.cart.accountDetails}),{customer:e}=qe(),{regions:r}=sn(),{step:s,setStep:i,goToNextStep:o,cart:c,isCartMutating:d}=L(),a=s===J.ACCOUNT_DETAILS;if(!c)return null;const u=(r??[]).flatMap(b=>b.countries.map(k=>k.iso_2)),m=or(c,e),p=Le(c),y=["submitting","loading"].includes(t.state),w=!!((l=t.data)!=null&&l.errors),v=(m==null?void 0:m.id)??ar,_=((N=(j=c.region)==null?void 0:j.countries)==null?void 0:N.map(b=>({value:b.iso_2,label:b.display_name})))??[],A={cartId:c.id,email:(e==null?void 0:e.email)||c.email||"",customerId:e==null?void 0:e.id,allowSuggestions:!0,shippingAddress:{...Me(m)},shippingAddressId:v},f=de({resolver:ue(fn),defaultValues:A,fetcher:t,submitConfig:{method:"post",action:"/api/checkout/account-details"}}),q=b=>{f.setValue("shippingAddress.address1",b.address.address1??""),f.setValue("shippingAddress.address2",b.address.address2??""),f.setValue("shippingAddress.city",b.address.city??""),f.setValue("shippingAddress.province",b.address.province??""),f.setValue("shippingAddress.countryCode",b.address.countryCode??""),f.setValue("shippingAddress.postalCode",b.address.postalCode??""),f.setValue("shippingAddress.phone",b.address.phone??""),f.setValue("shippingAddress.firstName",b.address.firstName??""),f.setValue("shippingAddress.lastName",b.address.lastName??""),f.setValue("shippingAddress.company",b.address.company??""),f.setValue("shippingAddress.phone",b.address.phone??"")},O=f.watch("shippingAddress");g.useEffect(()=>{a&&!y&&!w&&p&&(f.reset(),o())},[y,p]);const F=()=>{o()},h=p&&!a;return n.jsxs("div",{className:"checkout-account-details",children:[n.jsx(ft,{completed:h,setStep:i,step:J.ACCOUNT_DETAILS,children:"Account details"}),!a&&p&&n.jsx(Ft,{title:"Shipping Address",address:O,countryOptions:_}),a&&n.jsxs(n.Fragment,{children:[e!=null&&e.email?n.jsx("p",{className:"mt-2 text-sm mb-2",children:"To get started, please select your shipping address."}):n.jsx("p",{className:"mt-2 text-sm mb-4",children:"To get started, enter your email address."}),n.jsx(pe,{...f,children:n.jsxs(t.Form,{id:"checkout-account-details-form",onSubmit:f.handleSubmit,children:[n.jsx(H,{type:"hidden",name:"cartId"}),n.jsx(H,{type:"hidden",name:"customerId"}),n.jsx(Ie,{name:"email",type:"email",autoComplete:"email",placeholder:"Email address",label:"Email Address",className:"[&_input]:!ring-0 mb-2"}),n.jsx(gt,{address:O,prefix:"shippingAddress"}),n.jsx(Ie,{type:"hidden",name:"shippingAddressId",value:v}),n.jsx(Rt,{mode:"shipping",address:O,allowedCountries:u,setAddress:q}),n.jsx(Te,{}),n.jsxs(Qt,{children:[n.jsx(Oe,{disabled:y||d,children:y?"Saving...":"Save and continue"}),p&&n.jsx(le,{disabled:y,onClick:F,children:"Cancel edit"})]})]})})]})]})},lr="/assets/StripeBadge-D70kF_jj.png",dr=({className:t})=>n.jsx("img",{className:t,width:320,src:lr,alt:"stripe security badge"});z({page:Ae.number().int().min(0).default(0),pageSize:Ae.number().int().min(1).default(10),sortField:x().optional(),sortOrder:dn(["asc","desc"]).default("asc"),dataTableSearch:x().optional()}).passthrough();const ur=({shippingOption:t,region:e,value:r})=>{const s=r===t.id;return n.jsx("div",{className:"relative col-span-1",children:n.jsx("label",{htmlFor:t.id,className:"",children:n.jsxs("div",{className:U("group relative flex h-full flex-col justify-between rounded-lg border bg-white p-4 shadow-sm","active:ring-primary-500 hover:border-gray-400 focus:outline-none active:ring-2",s?"border-transparent":"border-gray-300"),children:[n.jsxs("div",{className:"flex justify-between gap-1",children:[n.jsx("div",{className:"block text-sm font-bold text-gray-900",children:t.name}),n.jsx(Xt,{id:t.id,value:t.id,className:"text-primary-600 h-5 w-5 border-0",indicator:n.jsx(Zt,{className:"text-primary-600 h-5 w-5","aria-hidden":"true"})})]}),n.jsx("div",{className:"mt-6 flex items-end justify-between text-sm text-gray-500",children:n.jsx("div",{children:je(t.amount,{currency:e.currency_code})})}),n.jsx("div",{className:U("pointer-events-none absolute -inset-px rounded-lg border-2 active:border",s?"border-primary-500":"border-transparent"),"aria-hidden":"true"})]})})})},pr=({name:t,shippingOptions:e,region:r,value:s,onValueChange:i,disabled:o})=>{const c=pt(),d=c.formState.isSubmitting,a=async u=>{if(!d){i==null||i(u);try{await c.handleSubmit()}catch(m){console.error("Failed to submit shipping option:",m)}}};return e.length?n.jsx(en,{name:t,value:s??"",onValueChange:a,className:U("xs:grid-cols-2 my-6 grid grid-cols-1 gap-4",d&&"pointer-events-none"),disabled:d||o,children:e.map(u=>n.jsx(ur,{shippingOption:u,region:r},u.id))}):n.jsx("div",{children:"No shipping options available"})},mr=(t,e)=>{var s;const r=((s=t.shipping_methods)==null?void 0:s.map(i=>i.shipping_option_id))??[];return Object.values(e).reduce((i,o)=>{const c=o.find(d=>r.includes(d.id));return i.push(c?c.id:o[0].id),i},[])},hr=(t,e)=>({cartId:t.id,shippingOptionIds:mr(t,e)}),fr=()=>{var f,q,O;const t=ee(),{step:e,shippingOptions:r,setStep:s,goToNextStep:i,cart:o,isCartMutating:c}=L(),d=e===J.PAYMENT,a=["submitting","loading"].includes(t.state);if(!o)return null;const u=!!((f=t.data)!=null&&f.errors),m=Le(o),p=g.useMemo(()=>De(r),[r]),y=g.useMemo(()=>bn(o,r),[o,r]),w=g.useMemo(()=>hr(o,p),[o,p]),v=de({resolver:ue(hn),defaultValues:w,fetcher:t,submitConfig:{method:"post",action:"/api/checkout/shipping-methods"}}),_=v.watch("shippingOptionIds");g.useEffect(()=>{var F;v.setValue("shippingOptionIds",((F=o.shipping_methods)==null?void 0:F.map(h=>h.shipping_option_id))??[])},[o.shipping_methods]),g.useEffect(()=>{d&&!a&&!u&&y&&i()},[a,y]);const A=!d&&m;return n.jsxs("div",{className:"checkout-delivery-method",children:[n.jsx(ft,{completed:A,setStep:s,step:J.PAYMENT,children:"Delivery & Payment"}),!d&&n.jsxs(n.Fragment,{children:[((q=o.shipping_methods)==null?void 0:q.length)===0&&n.jsx(dr,{className:"mt-4"}),n.jsx("dl",{children:(O=o.shipping_methods)==null?void 0:O.map((F,h)=>{var k;const{id:l,shipping_option_id:j,amount:N}=F,b=r.find(M=>M.id===j);return n.jsxs(g.Fragment,{children:[n.jsx("dt",{className:`${h>0?"mt-6":"mt-4"} text-sm font-bold text-gray-700`,children:"Delivery method for: All items"}),n.jsxs("dd",{className:"mt-0.5",children:[b==null?void 0:b.name," (",je(N,{currency:(k=o==null?void 0:o.region)==null?void 0:k.currency_code}),")"]})]},l)})})]}),d&&n.jsx(pe,{...v,children:n.jsxs(t.Form,{children:[n.jsx(H,{type:"hidden",name:"cartId",value:o.id}),Object.entries(p).map(([F,h],l)=>{var j;return h.length<1?null:n.jsxs(g.Fragment,{children:[l>0&&n.jsx("hr",{className:"my-6"}),!!((j=o==null?void 0:o.shipping_methods)!=null&&j.length)&&n.jsx(ve,{type:"info",className:"my-6",children:"Choose your delivery option"}),n.jsx(pr,{disabled:c,name:`shippingOptionIds.${l}`,shippingOptions:h,region:o.region,value:(_==null?void 0:_[l])??null,onValueChange:N=>v.setValue(`shippingOptionIds.${l}`,N)})]},F)})]})})]})},gr=({formId:t,item:e,className:r,maxInventory:s=10,...i})=>{const o=ee({key:be.cart.updateLineItem}),c=["submitting","loading"].includes(o.state),d=de({resolver:ue(gn),defaultValues:{lineItemId:e.id,quantity:e.quantity.toString()},fetcher:o,submitConfig:{method:"post",action:"/api/cart/line-items/update"}}),a=u=>{o.submit({lineItemId:e.id,quantity:u},{method:"post",action:"/api/cart/line-items/update"})};return n.jsx(pe,{...d,children:n.jsx(o.Form,{id:t,className:U("line-item-quantity-select",r),...i,onSubmit:d.handleSubmit,children:n.jsx(un,{formId:t,className:U({"pointer-events-none opacity-50":c}),variant:e.variant,onChange:a})})})},yr=({item:t,name:e})=>{var c,d,a;const{cart:r}=L(),s=on(),i=()=>s.submit(t),o=["loading","submitting"].includes(s.state);return r?n.jsxs("li",{className:"flex px-4 py-6 sm:px-6",children:[n.jsx("div",{className:"flex-shrink-0",children:n.jsx(pn,{src:((d=(c=t.variant)==null?void 0:c.product)==null?void 0:d.thumbnail)||"",alt:t.product_title||"product thumbnail",className:"w-20 rounded-md"})}),n.jsxs("div",{className:"ml-6 flex flex-1 flex-col",children:[n.jsxs("div",{className:"flex",children:[n.jsxs("div",{className:"min-w-0 flex-1",children:[n.jsx("h4",{className:"text-base",children:n.jsx(dt,{to:`/products/${t.product_handle}`,className:"font-bold text-gray-700 hover:text-gray-800",children:t.product_title})}),n.jsx("p",{className:"mt-0.5 text-sm text-gray-500",children:t.variant_title})]}),n.jsx("div",{className:"ml-4 flow-root flex-shrink-0",children:n.jsx(le,{variant:"link",onClick:i,disabled:o,className:"text-sm",children:o?"Removing":"Remove"})})]}),n.jsxs("div",{className:"flex flex-1 items-end justify-between pt-2",children:[n.jsx("div",{className:"mr-4",children:n.jsx(gr,{formId:`quantity-${e}-${t.id}`,item:t})}),n.jsx("p",{className:"mt-1 text-lg",children:n.jsx("span",{className:"font-bold text-gray-900",children:je(t.unit_price,{currency:(a=r.region)==null?void 0:a.currency_code})})})]})]})]}):null},xr=({cart:t,name:e})=>{var r;return n.jsx("ul",{role:"list",className:"divide-y divide-gray-200",children:(r=t.items)==null?void 0:r.map(s=>n.jsx(yr,{item:s,name:e},s.id))})},vr=({cart:t,promotion:e})=>{const r=ee({key:be.cart.removePromotionCode});return["submitting","loading"].includes(r.state)?null:n.jsxs(r.Form,{method:"post",action:"/api/checkout/remove-discount-code",children:[n.jsx("input",{type:"hidden",name:"cartId",value:t.id}),n.jsx("input",{type:"hidden",name:"code",value:e.code}),n.jsxs("button",{className:"focus:ring-primary-100 focus:border-primary-100 inline-flex h-8 items-center rounded-md border border-gray-300 bg-white px-2 text-xs font-bold text-gray-900 shadow-sm hover:bg-gray-100",children:[n.jsx("span",{children:e.code}),n.jsx("div",{className:"ml-[4px] inline-block text-gray-400",children:n.jsx(an,{className:"inline-block h-4 w-4 leading-none"})})]})]})},br=({cart:t})=>{var p,y,w;const e=g.useRef(null),r=g.useRef(null),s=ee(),[i,o]=g.useState(!!t.promotions.length),c=!!((p=t.promotions)!=null&&p.length),d=Object.keys(((y=s.data)==null?void 0:y.errors)||{}).length>0,a=["submitting","loading"].includes(s.state),u=de({resolver:ue(yn),defaultValues:{cartId:t.id,code:""},fetcher:s,submitConfig:{method:"post",action:"/api/checkout/discount-code"}});g.useEffect(()=>{var v;!a&&!d&&(u.reset(),(v=r.current)==null||v.focus())},[a,d]);const m=()=>{o(!0),setTimeout(()=>{var v;return(v=r.current)==null?void 0:v.focus()},0)};return n.jsxs("div",{className:"mb-6",children:[!i&&n.jsx("div",{children:n.jsx(mn,{size:"sm",onClick:m,children:"Add promo code"})}),i&&n.jsxs(n.Fragment,{children:[n.jsx(pe,{...u,children:n.jsxs(s.Form,{ref:e,onSubmit:u.handleSubmit,children:[n.jsx("input",{type:"hidden",name:"cartId",value:t.id}),n.jsxs("div",{className:"!my-0 !flex items-start gap-1",children:[n.jsx(Ie,{name:"code",className:"flex-grow",placeholder:"Discount code","aria-label":"discount code"}),n.jsx(Oe,{type:"submit",className:"flex-shrink-0 flex-grow-0",disabled:a,children:a?"Applying...":"Apply"})]}),n.jsx(Te,{})]})}),c&&n.jsx("div",{className:"mt-2",children:(w=t.promotions)==null?void 0:w.map(v=>n.jsx(vr,{cart:t,promotion:v},v.id))})]})]})},X=({label:t,amount:e,className:r,region:s})=>n.jsxs("div",{className:U("flex items-center justify-between text-sm",r),children:[n.jsx("dt",{children:t}),n.jsx("dd",{className:"font-bold text-gray-900",children:je(e||0,{currency:s==null?void 0:s.currency_code})})]}),jr=({shippingOptions:t,cart:e})=>{const s=(e.shipping_methods||[]).length>0,i=jn(t),o=e.discount_total??0,c=e.shipping_total??0,d=e.total??0,a=s?d:d+i;return n.jsxs("div",{className:"border-t border-gray-200 px-4 py-6 sm:px-6",children:[n.jsx(br,{cart:e}),n.jsxs("dl",{className:"flex flex-col gap-2",children:[n.jsx(X,{label:"Subtotal",amount:e.item_subtotal,region:e.region}),o>0&&n.jsx(X,{label:"Discount",amount:-o,region:e.region}),s&&n.jsx(X,{label:"Shipping",amount:c,region:e.region}),!s&&n.jsx(X,{label:"Estimated Shipping",amount:i,region:e.region}),n.jsx(X,{label:"Taxes",amount:e.tax_total,region:e.region}),n.jsx(X,{label:"Total",amount:a,className:"border-t border-gray-200 pt-6 !text-xl",region:e.region})]})]})},Tt=({submitButton:t,name:e})=>{const{shippingOptions:r,cart:s}=L();return s?n.jsxs("div",{className:"my-0 rounded-lg border border-gray-200 bg-white shadow-sm",children:[n.jsx("h3",{className:"sr-only",children:"Items in your cart"}),n.jsx(xr,{cart:s,name:e}),n.jsx(jr,{cart:s,shippingOptions:r}),t&&n.jsx("div",{className:"border-t border-gray-200 p-4 sm:p-6",children:t})]}):null},Ot=({id:t,submitMessage:e,onSubmit:r,paymentMethods:s,children:i,providerId:o,className:c})=>{var M,D;const{activePaymentSession:d,cart:a,isCartMutating:u}=L(),m=ee({key:be.cart.completeCheckout}),[p,y]=g.useState(!1),w=["submitting","loading"].includes(m.state)||p,v=s.filter(C=>C.provider_id===o),_=v.length>0,A=_?v[0].data.id:"new";if(!a)return null;const f=Me(a.billing_address),q=ir(a==null?void 0:a.shipping_address)??Pe,O=((D=(M=a.region)==null?void 0:M.countries)==null?void 0:D.map(C=>({value:C.iso_2,label:C.display_name})))??[],F={cartId:a.id,paymentMethodId:A,sameAsShipping:!0,billingAddress:f,providerId:o},h=de({resolver:ue(Sn),defaultValues:F,fetcher:m,submitConfig:{method:"post",action:"/api/checkout/complete"}}),l=h.watch("sameAsShipping"),j=h.watch("billingAddress"),N=async C=>{C.preventDefault(),y(!0);const $=h.getValues();return typeof r=="function"?await r($,C,{setSubmitting:y,submit:()=>h.handleSubmit()}):h.handleSubmit()},b=C=>{h.setValue("billingAddress.address1",C.address.address1??""),h.setValue("billingAddress.address2",C.address.address2??""),h.setValue("billingAddress.city",C.address.city??""),h.setValue("billingAddress.province",C.address.province??""),h.setValue("billingAddress.countryCode",C.address.countryCode??""),h.setValue("billingAddress.postalCode",C.address.postalCode??""),h.setValue("billingAddress.phone",C.address.phone??""),h.setValue("billingAddress.firstName",C.address.firstName??""),h.setValue("billingAddress.lastName",C.address.lastName??""),h.setValue("billingAddress.company",C.address.company??""),h.setValue("billingAddress.phone",C.address.phone??"")},k=()=>n.jsx(Oe,{form:t,className:"w-full lg:w-auto",disabled:w||u||!l&&!j,children:w?"Confirming...":e??"Confirm & Pay"});return d?n.jsx(n.Fragment,{children:n.jsxs(pe,{...h,children:[n.jsxs(m.Form,{id:t,onSubmit:N,className:c,children:[n.jsx(H,{type:"hidden",name:"cartId",value:a.id}),n.jsx(H,{type:"hidden",name:"providerId",value:o}),n.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Billing address"}),n.jsx(xn,{className:"my-4",name:"sameAsShipping",label:"Same as shipping address"}),!l&&n.jsx(Rt,{mode:"billing",address:j,setAddress:b}),n.jsx(gt,{address:j,prefix:"billingAddress"}),l&&n.jsx("div",{className:"-mt-2 mb-4",children:n.jsx(Ft,{address:q.address,countryOptions:O})}),!_&&n.jsx("input",{type:"hidden",name:"paymentMethodId",value:"new"}),n.jsx("div",{className:`stripe-payment-form ${A!=="new"?"hidden":""}`,children:i}),n.jsx(Te,{})]}),n.jsx("div",{className:"block lg:hidden",children:n.jsx(Tt,{name:"checkout",submitButton:n.jsx(k,{})})}),n.jsx("div",{className:"hidden lg:block",children:n.jsx(k,{})})]})}):null},Cr=t=>n.jsx(Ot,{providerId:"pp_system_default",id:"TestPaymentForm",submitMessage:"Checkout using Test Payment",className:"mt-4",...t}),Mt=({options:t,children:e})=>{var d,a;const{env:r}=Ve(),{cart:s}=L(),i=g.useMemo(()=>r.STRIPE_PUBLIC_KEY?It(r.STRIPE_PUBLIC_KEY):null,[]),o=g.useMemo(()=>{var u,m;return(m=(u=s==null?void 0:s.payment_collection)==null?void 0:u.payment_sessions)==null?void 0:m.find(p=>p.provider_id==="pp_stripe_stripe")},[(d=s==null?void 0:s.payment_collection)==null?void 0:d.payment_sessions]),c=(a=o==null?void 0:o.data)==null?void 0:a.client_secret;return!o||!i||!c?null:n.jsx(Be,{stripe:i,options:t??{clientSecret:c},children:e},c)},Sr=({isActiveStep:t,paymentMethods:e})=>{var _,A;const[r,s]=g.useState(),[i,o]=g.useState(),c=wt(),d=Nt(),{activePaymentSession:a,cart:u}=L(),m=g.useMemo(()=>e==null?void 0:e.filter(f=>f.provider_id==="pp_stripe_stripe"),[e]);g.useEffect(()=>{d&&d.fetchUpdates()},[(_=a==null?void 0:a.payment)==null?void 0:_.updated_at]);const p=m.length>0,y=p?(A=m[0].data)==null?void 0:A.id:"new";if(g.useEffect(()=>{t&&r&&r.focus()},[t,r]),!u||!c||!d)return null;const w=async(f,q,{setSubmitting:O,submit:F})=>{if(o(void 0),f.paymentMethodId!=="new"){F(q.target);return}const h=f.sameAsShipping?Me(u.billing_address):f.billingAddress,l={name:`${h.firstName} ${h.lastName}`,email:u.email,phone:h.phone||"",address:{line1:h.address1||"",line2:h.address2||"",city:h.city||"",state:h.province||"",postal_code:h.postalCode||"",country:h.countryCode||""}};return O(!0),c.confirmPayment({elements:d,confirmParams:{return_url:`${window.location.origin}/checkout/success`,payment_method_data:{billing_details:l}},redirect:"if_required"}).then(({paymentIntent:j,error:N})=>{if(N){o(N.message),O(!1),r==null||r.focus();return}F(q.target)}).catch(j=>{O(!1),console.error(j)})},v=f=>{s(f)};return n.jsx(n.Fragment,{children:n.jsx(Ot,{providerId:"pp_stripe_stripe",id:"stripePaymentForm",paymentMethods:m,onSubmit:w,children:n.jsxs("div",{className:U({"h-0 overflow-hidden opacity-0":p&&y!=="new"}),children:[n.jsx(Hn,{onReady:v,className:"my-6 w-full",options:{fields:{billingDetails:{address:{country:"never",postalCode:"never"}}},terms:{card:"never"}}}),i&&n.jsx(ve,{type:"error",className:U("form__error -mt-4 mb-2"),children:i})]})})})},_r=t=>{const{isActiveStep:e,...r}=t;return n.jsx(Mt,{children:n.jsx(Sr,{...r,isActiveStep:e})})},Nr=()=>{const{env:t}=Ve(),{step:e,paymentProviders:r,cart:s}=L(),i=e===J.PAYMENT;if(!s)return null;const o=g.useMemo(()=>r==null?void 0:r.some(u=>u.id.includes("pp_stripe_stripe")),[r]),c=g.useMemo(()=>!!(r!=null&&r.some(u=>u.id.includes("pp_system_default"))),[r]),d=[{id:"pp_stripe_stripe",label:"Credit Card",component:_r,isActive:o},{id:"pp_system_default",label:"Test Payment",component:Cr,isActive:c&&t.NODE_ENV==="development"}],a=g.useMemo(()=>d.filter(u=>u.isActive),[d]);return n.jsx("div",{className:"checkout-payment",children:n.jsx("div",{className:U({"h-0 overflow-hidden opacity-0":!i}),children:n.jsxs(oe.Group,{children:[a.length>1&&n.jsx(oe.List,{className:"bg-primary-50 mb-2 mt-6 inline-flex gap-0.5 rounded-full p-2",children:a.map((u,m)=>n.jsx(oe,{as:le,className:({selected:p})=>U("!rounded-full",{"!bg-white !text-gray-700 shadow-sm":p,"!bg-primary-50 !border-primary-100 !text-primary-600 hover:!text-primary-800 hover:!bg-primary-100 !border-none":!p}),children:u.label},u.id))}),n.jsx(oe.Panels,{children:a.map(u=>{const m=u.component;return n.jsx(oe.Panel,{children:n.jsx(m,{isActiveStep:i,paymentMethods:[]})},u.id)})})]})})})},xe=t=>(t??0)*100,ge={update:async t=>{const e=await fetch("/api/checkout/express",{method:"POST",body:ke(t)});return e.ok?[await e.json(),null]:[null,new Error("Failed to update shipping address")]}},lt=t=>t!=null&&t.length?t.map((e,r)=>({id:e.id??r.toString(),displayName:e.name??`Shipping Option ${r+1}`,amount:xe(e.amount??0)})).sort((e,r)=>e.amount-r.amount)??[]:[],Er=()=>n.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[n.jsx("div",{className:"h-11 animate-pulse rounded-lg bg-gray-200"}),n.jsx("div",{className:"h-11 animate-pulse rounded-lg bg-gray-200"})]}),wr=()=>{const t=$t(),[e,r]=g.useState(null),s=wt(),i=Nt(),{cart:o}=L(),[c,d]=g.useState(o),[a,u]=g.useState("first_load"),[m,p]=g.useState(null),{shippingOptions:y,paymentProviders:w}=L(),v=w.some(l=>l.id==="pp_stripe_stripe");if(!c||!v||a==="unavailable")return null;const _=async()=>{location.reload(),p(null)},A=({availablePaymentMethods:l,...j})=>{if(!l){u("unavailable");return}u("available")},f=({resolve:l,expressPaymentType:j})=>{p(j);const N={emailRequired:!0,shippingAddressRequired:!0,billingAddressRequired:!0,phoneNumberRequired:!0,shippingRates:lt(y)};l(N)},q=async l=>{var j,N,b,k,M,D,C,$,P,Q,B,G,W,K,T,te,ne,re,se,me,Ue,$e,We,Ye,Ge,Ke,ze,He;try{if(!s||!i){l.paymentFailed({reason:"fail"});return}const Y=(b=((j=l.billingDetails)==null?void 0:j.name)??((N=l.shippingAddress)==null?void 0:N.name))==null?void 0:b.split(" ");if(!Y){console.error("No name provided"),r({title:"No name provided",description:"Please provide a valid name."}),l.paymentFailed({reason:"fail"});return}const Se={firstName:Y[0]??"",lastName:Y[1]??"",address1:((k=l.shippingAddress)==null?void 0:k.address.line1)??"",address2:((M=l.shippingAddress)==null?void 0:M.address.line2)??"",city:((D=l.shippingAddress)==null?void 0:D.address.city)??"",province:((C=l.shippingAddress)==null?void 0:C.address.state)??"",postalCode:(($=l.shippingAddress)==null?void 0:$.address.postal_code)??"",countryCode:((P=l.shippingAddress)==null?void 0:P.address.country.toLowerCase())??"",phone:((Q=l.billingDetails)==null?void 0:Q.phone)??""},Dt={firstName:Y[0]??"",lastName:Y[1]??"",address1:((G=(B=l.billingDetails)==null?void 0:B.address)==null?void 0:G.line1)??"",address2:((K=(W=l.billingDetails)==null?void 0:W.address)==null?void 0:K.line2)??"",city:((te=(T=l.billingDetails)==null?void 0:T.address)==null?void 0:te.city)??"",province:((re=(ne=l.billingDetails)==null?void 0:ne.address)==null?void 0:re.state)??"",postalCode:((me=(se=l.billingDetails)==null?void 0:se.address)==null?void 0:me.postal_code)??"",countryCode:((We=($e=(Ue=l.billingDetails)==null?void 0:Ue.address)==null?void 0:$e.country)==null?void 0:We.toLowerCase())??"",phone:((Ye=l.billingDetails)==null?void 0:Ye.phone)??"",company:((Ge=l.billingDetails)==null?void 0:Ge.name)??""},[Lt,Je]=await ge.update({cartId:c.id,email:((Ke=l.billingDetails)==null?void 0:Ke.email)??c.email,shippingAddress:Se,billingAddress:Dt,complete:!1});if(Je){r({title:"Error updating account details",description:Je.message}),l.paymentFailed({reason:"fail"});return}const Qe=Lt.cart,_e=(He=(ze=Qe.payment_collection)==null?void 0:ze.payment_sessions)==null?void 0:He.find(({provider_id:ie,status:Vt})=>ie==="pp_stripe_stripe"&&Vt==="pending"),Ne=_e==null?void 0:_e.data.client_secret;if(!Ne)throw new Error("No client secret provided in express checkout");const Xe=await s.confirmPayment({elements:i,clientSecret:Ne,confirmParams:{return_url:`${window.location.origin}/checkout/success`,payment_method_data:{billing_details:l.billingDetails}},redirect:"if_required"}),{error:Ee}=Xe;if(Ee){console.error(Ee),r({title:"Payment failed",description:Ee.message??"Error trying to confirm payment."}),l.paymentFailed({reason:"fail"});return}const Ze=Xe.paymentIntent;if(!Ze)throw new Error("Error trying to confirm payment.");if(Ze.status==="requires_action"){const{error:ie}=await s.confirmCardPayment(Ne);if(ie){console.error(ie),r({title:"Payment failed",description:ie.message??"Please provide a new payment method."}),l.paymentFailed({reason:"fail"});return}}const[qt,et]=await ge.update({cartId:Qe.id,complete:!0});if(et)throw console.error(et),new Error("Error trying to complete checkout.");const{order:tt}=qt;if(!tt)throw new Error("Error trying to complete checkout.");t(`/checkout/success?order_id=${tt.id}`)}catch(Y){console.error(Y);const Se=Y instanceof Error?Y.message:"Error trying to submit payment.";r({title:"Payment failed",description:Se}),l.paymentFailed({reason:"fail"})}},O=async l=>{var W,K,T,te,ne,re,se;const j={firstName:"",lastName:"",address1:"",address2:"",city:((W=l.address)==null?void 0:W.city)??"",province:((K=l.address)==null?void 0:K.state)??"",postalCode:l.address.postal_code??"",countryCode:((T=l.address)==null?void 0:T.country.toLowerCase())??"",phone:"",company:""},[N,b]=await ge.update({cartId:c.id,email:c.email??void 0,shippingAddress:j});if(b)return r({title:"Error updating shipping address",description:b.message}),l.reject();const{cart:k,shippingOptions:M}=N;d(k);const D=lt(M);if(!D.length)return r({title:"No shipping methods available",description:"Please provide a valid shipping address."}),l.reject();let C=k;const $=D[0].id,P=(ne=(te=k.shipping_methods)==null?void 0:te[0])==null?void 0:ne.shipping_option_id,Q=P&&((se=(re=k.shipping_methods)==null?void 0:re.find(({shipping_option_id:me})=>P===me))==null?void 0:se.shipping_option_id);if(C=await h(m==="apple_pay"?Q??$:$),!C)return l.reject();d(C),i==null||i.update({amount:xe(C.total)});const G={shippingRates:D};return l.resolve(G)},F=async l=>{const j=await h(l.shippingRate.id);if(!j)return l.reject();i==null||i.update({amount:xe(j.total)}),l.resolve(),d(j)},h=async l=>{const[j,N]=await ge.update({cartId:c.id,shippingOptions:[l]});if(N)return r({title:"Error updating shipping rate",description:N.message}),null;const{cart:b}=j;return b};return n.jsxs(n.Fragment,{children:[(a==="available"||a==="first_load")&&n.jsxs(n.Fragment,{children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Express Checkout"}),e?n.jsx(ve,{type:"error",title:e.title,className:"mt-4",children:e.description}):null]}),n.jsxs("div",{className:"py-4",children:[a==="first_load"&&n.jsx(Er,{}),n.jsx(Jn,{options:{paymentMethodOrder:["apple_pay","google_pay","link","card"],paymentMethods:{applePay:"always",googlePay:"always",link:"auto"}},onCancel:_,onReady:A,onShippingAddressChange:O,onClick:f,onConfirm:q,onShippingRateChange:F})]}),(a==="available"||a==="first_load")&&n.jsxs("div",{className:"grid grid-cols-[1fr_auto_1fr] items-center gap-x-4 py-4",children:[n.jsx("hr",{className:"w-full border-gray-300"}),n.jsx("div",{className:"flex items-center justify-center pb-1 text-gray-500",children:"or"}),n.jsx("hr",{className:"w-full border-gray-300"})]})]})},Ar=({cart:t})=>{L();const e={mode:"payment",amount:xe(t.total),currency:(t==null?void 0:t.currency_code)||"usd",capture_method:"manual"};return n.jsx(Mt,{options:e,children:n.jsx(wr,{})})},kr=()=>{const{customer:t}=qe(),{goToNextStep:e,cart:r}=L(),s=!!(t!=null&&t.id);if(r)return g.useEffect(()=>(s&&e(),()=>e()),[s]),n.jsx(n.Fragment,{children:n.jsxs("div",{className:"lg:min-h-[calc(100vh-320px)] lg:pl-8",children:[s&&n.jsxs(ve,{type:"info",className:"mb-8",children:["Checking out as:"," ",n.jsxs("strong",{className:"font-bold",children:[t.first_name," ",t.last_name," (",t.email,")"]})]}),n.jsx(Ar,{cart:r}),n.jsx(cr,{}),n.jsx("hr",{className:"my-10"}),n.jsx(fr,{}),n.jsx(Nr,{})]})})},Pr=()=>{const{step:t}=L();return n.jsx("div",{className:U("h-full",{"hidden lg:block":t===J.PAYMENT}),children:n.jsx("div",{className:"sticky top-24",children:n.jsx(Tt,{name:"sidebar"})})})},Ir=({icon:t,title:e,description:r,action:s})=>n.jsxs("div",{className:"py-16 text-center",children:[t&&n.jsx("div",{className:"inline-block text-gray-300",children:n.jsx(t,{className:"h-10 w-10"})}),n.jsx("h2",{className:"mt-2 text-lg font-bold text-gray-900",children:e}),n.jsx("p",{className:"mt-1 text-sm text-gray-500",children:r}),s&&n.jsx("div",{className:"mt-6",children:s})]}),Kr=Wt(function(){var o;const{shippingOptions:e,paymentProviders:r,activePaymentSession:s,cart:i}=Yt();return!i||!((o=i.items)!=null&&o.length)?n.jsx(Ir,{icon:cn,title:"No items in your cart.",description:"Add items to your cart",action:n.jsx(le,{variant:"primary",as:c=>n.jsx(dt,{to:"/products",...c}),children:"Start shopping"})}):n.jsx(En,{data:{cart:i,activePaymentSession:s,shippingOptions:e,paymentProviders:r},children:n.jsx("section",{children:n.jsx("div",{className:"mx-auto max-w-2xl px-4 pb-8 pt-6 sm:px-6 sm:pb-16 sm:pt-8 lg:max-w-7xl lg:px-8 lg:pb-24 lg:pt-16",children:n.jsxs("div",{className:"lg:grid lg:grid-cols-[4fr_3fr] lg:gap-x-12 xl:gap-x-16",children:[n.jsx(kr,{}),n.jsx(Pr,{})]})})})})});export{Kr as default};
