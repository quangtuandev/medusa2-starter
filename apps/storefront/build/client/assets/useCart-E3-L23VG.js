import{c as M,m as h,u as O,F as b}from"./prices-EERMpwH6.js";import{r as o,j as A,f as B}from"./chunk-OIYGIGL5-O3V7dfML.js";var v=(e=>(e.cart="cart",e.login="login",e.search="search",e))(v||{}),w=(e=>(e.toggle="toggle",e.set="set",e))(w||{});const k=o.createContext(null),H={set:(e,{target:t,state:n})=>({...e,[t]:h({},e[t],n)}),toggle:(e,{target:t,open:n,state:s})=>({...e,[t]:h({},e[t],s,{open:n??!e[t].open})})},K=M({actionHandlers:H}),q={cart:{},login:{},search:{}},U=({data:e,...t})=>{const[n,s]=o.useReducer(K,q);return A.jsx(k.Provider,{value:{state:h({},n,e),dispatch:s},...t})},p=(e,t)=>typeof t=="boolean"?{name:w.toggle,payload:{open:t,target:e}}:{name:w.toggle,payload:{...t,target:e}},z=({dispatch:e})=>({toggleCartDrawer:t=>e(p(v.cart,t)),toggleLoginModal:t=>e(p(v.login,t)),toggleSearchDrawer:t=>e(p(v.search,t))}),G=()=>{const e=o.useContext(k);if(!e)throw new Error("useStorefront must be used within a StorefrontContext.Provider");return{...e,actions:z(e)}},V=()=>{var x,S,E,L,y;const{state:e,actions:t}=G(),n=O(),s=B(),[l,m]=o.useState(!1),g=o.useRef(null),C=o.useRef(0),a={removing:s.find(r=>{var u;return(r.state==="submitting"||r.state==="loading")&&r.key===b.cart.removeLineItem&&((u=r.formData)==null?void 0:u.get("lineItemId"))}),adding:s.filter(r=>{var u;return r.key===b.cart.createLineItem&&(r.state==="submitting"||r.state==="loading")&&((u=r.formData)==null?void 0:u.has("variantId"))})},f=n==null?void 0:n.cart,D=(f==null?void 0:f.items)||[],c=D.length;a.removing&&console.log("removing",(S=(x=a.removing)==null?void 0:x.formData)==null?void 0:S.get("lineItemId"));const d=a.adding.length>0,I=(L=(E=a.removing)==null?void 0:E.formData)==null?void 0:L.get("lineItemId"),R=I&&(c===1&&I===((y=D[0])==null?void 0:y.id)||c===0&&C.current===1&&a.removing),i=o.useCallback(()=>{g.current!==null&&(window.clearTimeout(g.current),g.current=null)},[]),F=o.useCallback(r=>{r!==!!e.cart.open&&(t.toggleCartDrawer(r),r||m(!1))},[t,e.cart.open]);o.useEffect(()=>{i();const r=!!e.cart.open;return R&&!l&&(m(!0),r&&(g.current=window.setTimeout(()=>{t.toggleCartDrawer(!1),m(!1)},1500))),C.current=c,i},[e.cart.open,c,R,l,t,i]),o.useEffect(()=>{(!e.cart.open||d)&&m(!1)},[e.cart.open,d]),o.useEffect(()=>i,[i]);const j=!d&&c===0&&!l,P=e.cart.open===!0;return{cart:f,isAddingItem:d,isRemovingItemId:I,isRemovingLastItem:l,cartDrawerOpen:P,toggleCartDrawer:F,showEmptyCartMessage:j}};export{U as S,q as s,V as u};
