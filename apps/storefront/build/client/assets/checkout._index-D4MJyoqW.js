import{j as r,r as d,k as St,g as Ct,R as S,f as H,L as We,a as Nt,w as Et,u as _t}from"./chunk-OIYGIGL5-DA7B83DT.js";import{b as At,h as wt,x as kt,D as Pt,M as It,a as z,F as be,A as Rt,o as Ot,s as ke,e as Tt,c as Pe,f as Dt,d as Ft,m as Bt,g as je}from"./data-table-router-form-CkmP4trt.js";import{u as Ge,e as Lt,h as Mt,d as Ut,a as pe,f as oe}from"./PlusIcon-B0nCS5Pn.js";import{B as ee}from"./Button-1to4fflA.js";import{c as q}from"./clsx-B-dksMZM.js";import{u as qt,a as Vt,F as $t,b as Wt}from"./useRegions-CznciT20.js";import{o as Q,c as Gt,s as b,d as he,e as Ie,b as ae}from"./zod-CNLNciQm.js";import{u as Ke,a as ie,R as ce,S as Se}from"./SubmitButton-C4Dj4QRZ.js";import{I as Kt}from"./Image-C-YIAXD2.js";import{n as Yt,Q as Jt}from"./QuantitySelector-DJC1BZ_H.js";import{B as zt}from"./ButtonLink-D1OnKopR.js";import{d as te}from"./tabs-BuLBB7EY.js";import"./createLucideIcon-CzAA8fGv.js";import"./index-gMKRMYsJ.js";import"./use-is-mounted-CV1LEgbp.js";const ye=(e,t=new FormData,n="")=>e==null?t:typeof e=="object"&&!(e instanceof Date)&&!(e instanceof File)?(Object.entries(e).forEach(([s,a])=>{ye(a,t,n?e[s]instanceof File?n:`${n}.${s}`:s)}),t):Array.isArray(e)?(e.forEach((s,a)=>{ye(s,t,`${n}.${a}`)}),t):(t.append(n,e),t),Qt=Q({cartId:b(),shippingOptionIds:Gt(b())}),Ht=Q({cartId:b(),customerId:b().optional(),email:b().email("Please enter a valid email"),shippingAddress:Q({firstName:b().min(1,"First name is required"),lastName:b().min(1,"Last name is required"),company:b().optional(),address1:b().min(1,"Address is required"),address2:b().optional(),city:b().min(1,"City is required"),province:b().min(1,"Province is required"),countryCode:b().min(1,"Country is required"),postalCode:b().min(1,"Postal code is required"),phone:b().optional()}),shippingAddressId:b(),isExpressCheckout:he().optional()}),Xt=Q({lineItemId:b().min(1,"Line item ID is required"),quantity:Yt().int()}),Zt=Q({cartId:b(),code:b().min(1,"Discount code is required")});function en(e){const{control:t}=Ke(),{components:n,...s}=e,a={FormDescription:It,FormControl:Pt,FormLabel:kt,FormMessage:wt,...n};return r.jsx(At,{control:t,components:a,...s})}const ge={firstName:"",lastName:"",company:"",address1:"",address2:"",city:"",province:"",postalCode:"",countryCode:"",phone:""},Ye=e=>e?{...ge,firstName:(e==null?void 0:e.first_name)||"",lastName:(e==null?void 0:e.last_name)||"",company:(e==null?void 0:e.company)||"",address1:(e==null?void 0:e.address_1)||"",address2:(e==null?void 0:e.address_2)||"",city:(e==null?void 0:e.city)||"",countryCode:(e==null?void 0:e.country_code)||"",phone:(e==null?void 0:e.phone)||"",postalCode:(e==null?void 0:e.postal_code)||"",province:(e==null?void 0:e.province)||""}:ge,Ce=e=>{const t=e.reduce((n,s)=>{const a=s.shipping_profile_id;return a&&(n[a]||(n[a]=[]),n[a].push(s)),n},{});return Object.keys(t).forEach(n=>t[n].sort((s,a)=>(s.amount||0)-(a.amount||0))),t},tn=(e,t)=>!!e.email||!!(t!=null&&t.email),Ne=e=>{var t;return!!((t=e.shipping_address)!=null&&t.address_1)},nn=(e,t)=>{var a;const n=((a=e.shipping_methods)==null?void 0:a.map(o=>o.shipping_option_id))||[],s=Ce(t);return Object.values(s).every(o=>o.find(i=>n.includes(i.id)))};function rn(e){if((e==null?void 0:e.length)<1)return 0;const t=Ce(e);return Object.values(t).reduce((n,s)=>{const a=s.reduce((o,i)=>(o.amount||0)<((i==null?void 0:i.amount)||0)?o:i);return n+(a.amount||0)},0)}const sn=Q({firstName:b().min(1,"First name is required").optional(),lastName:b().min(1,"Last name is required").optional(),company:b().optional(),address1:b().min(1,"Address is required").optional(),address2:b().optional(),city:b().min(1,"City is required").optional(),province:b().min(1,"Province is required").optional(),countryCode:b().min(1,"Country is required"),postalCode:b().min(1,"Postal code is required"),phone:b().optional()}),on=Q({cartId:b(),providerId:b(),paymentMethodId:b(),sameAsShipping:he().optional(),billingAddress:Ie(),noRedirect:he().optional()}).refine(e=>e.sameAsShipping?Ie():sn.safeParse(e.billingAddress).success,{message:"Valid billing address is required when creating a new address",path:["root"]}),Ee=()=>{const e=Ge();return{customer:e==null?void 0:e.customer}};var K=(e=>(e.CONTACT_INFO="contactInfo",e.ACCOUNT_DETAILS="accountDetails",e.PAYMENT="payment",e.SUCCESS="success",e))(K||{});const Je=e=>{const{cart:t}=e,{customer:n}=Ee(),s=!!(n!=null&&n.id),a=d.useMemo(()=>tn(t,n),[t,n]),o=d.useMemo(()=>Ne(t),[t,s]);let i="accountDetails";return a&&(i="accountDetails"),o&&(i="payment"),i},ze=d.createContext(null),an={setStep:(e,t)=>({...e,step:t})},cn=Lt({actionHandlers:an}),ln=({data:e,...t})=>{const s={step:Je({...e}),cart:null,shippingOptions:[],paymentProviders:[],activePaymentSession:null},[a,o]=d.useReducer(cn,s);return r.jsx(ze.Provider,{value:{state:{...a,...e},dispatch:o},...t})},un=({dispatch:e})=>({setStep:t=>e({name:"setStep",payload:t})}),V=()=>{const e=d.useContext(ze),t=Je(e.state),{state:n}=e,a=St().filter(o=>o.key.startsWith(Mt));if(!n.step)throw new Error("useCheckout must be used within a CheckoutProvider");return{...n,...un(e),goToNextStep:()=>e.dispatch({name:"setStep",payload:t}),isCartMutating:a.some(o=>["loading","submitting"].includes(o.state))}},ve=({className:e,name:t,...n})=>r.jsx(z,{...n,className:q("[&_input]:!h-12 [&_input]:border-gray-200 [&_input]:!bg-white [&_input]:text-[16px] [&_input]:shadow-sm [&_input]:!ring-0","[&_input:-webkit-autofill]:!transition-[background-color_5000s_ease-in-out_0s]","[&_input:-webkit-autofill]:!shadow-[0_0_0_1000px_white_inset]","[&_label]:text-[16px] [&_label]:text-gray-600",e),name:t});function dn({title:e,titleId:t,...n},s){return d.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),e?d.createElement("title",{id:t},e):null,d.createElement("path",{fillRule:"evenodd",d:"M19.916 4.626a.75.75 0 0 1 .208 1.04l-9 13.5a.75.75 0 0 1-1.154.114l-6-6a.75.75 0 0 1 1.06-1.06l5.353 5.353 8.493-12.74a.75.75 0 0 1 1.04-.207Z",clipRule:"evenodd"}))}const pn=d.forwardRef(dn),Qe=({completed:e,setStep:t,step:n,children:s})=>r.jsxs("header",{className:"relative flex items-center justify-between",children:[r.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:s}),e&&r.jsxs(r.Fragment,{children:[r.jsx(ee,{className:"text-sm",variant:"link",onClick:()=>t(n),children:"Edit"}),r.jsx("span",{className:"absolute -left-10 mt-0.5 hidden h-6 w-6 items-center justify-center rounded-full bg-green-100 text-green-700 md:flex",children:r.jsx(pn,{className:"h-4 w-4"})})]})]}),He=({address:e,prefix:t})=>r.jsx(r.Fragment,{children:Object.keys(e).map(n=>{const s=n;if(e[s]!=null)return r.jsx(z,{type:"hidden",name:`${t}.${n}`,value:e[s]??""},s)})}),Xe=()=>{const e=Ge();if(!(e!=null&&e.env))throw new Error("No env data found, this should be provided in the root loader");return{env:e==null?void 0:e.env}};var Ze={exports:{}},mn="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",fn=mn,hn=fn;function et(){}function tt(){}tt.resetWarningCache=et;var yn=function(){function e(s,a,o,i,l,c){if(c!==hn){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:tt,resetWarningCache:et};return n.PropTypes=n,n};Ze.exports=yn();var gn=Ze.exports;const w=Ct(gn);function Re(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable})),n.push.apply(n,s)}return n}function Oe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Re(Object(n),!0).forEach(function(s){nt(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function de(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?de=function(t){return typeof t}:de=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de(e)}function nt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rt(e,t){return vn(e)||xn(e,t)||bn(e,t)||jn()}function vn(e){if(Array.isArray(e))return e}function xn(e,t){var n=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]);if(n!=null){var s=[],a=!0,o=!1,i,l;try{for(n=n.call(e);!(a=(i=n.next()).done)&&(s.push(i.value),!(t&&s.length===t));a=!0);}catch(c){o=!0,l=c}finally{try{!a&&n.return!=null&&n.return()}finally{if(o)throw l}}return s}}function bn(e,t){if(e){if(typeof e=="string")return Te(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Te(e,t)}}function Te(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function jn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var M=function(t,n,s){var a=!!s,o=S.useRef(s);S.useEffect(function(){o.current=s},[s]),S.useEffect(function(){if(!a||!t)return function(){};var i=function(){o.current&&o.current.apply(o,arguments)};return t.on(n,i),function(){t.off(n,i)}},[a,n,t,o])},xe=function(t){var n=S.useRef(t);return S.useEffect(function(){n.current=t},[t]),n.current},Z=function(t){return t!==null&&de(t)==="object"},Sn=function(t){return Z(t)&&typeof t.then=="function"},Cn=function(t){return Z(t)&&typeof t.elements=="function"&&typeof t.createToken=="function"&&typeof t.createPaymentMethod=="function"&&typeof t.confirmCardPayment=="function"},De="[object Object]",Nn=function e(t,n){if(!Z(t)||!Z(n))return t===n;var s=Array.isArray(t),a=Array.isArray(n);if(s!==a)return!1;var o=Object.prototype.toString.call(t)===De,i=Object.prototype.toString.call(n)===De;if(o!==i)return!1;if(!o&&!s)return t===n;var l=Object.keys(t),c=Object.keys(n);if(l.length!==c.length)return!1;for(var u={},m=0;m<l.length;m+=1)u[l[m]]=!0;for(var p=0;p<c.length;p+=1)u[c[p]]=!0;var f=Object.keys(u);if(f.length!==l.length)return!1;var j=t,g=n,y=function(h){return e(j[h],g[h])};return f.every(y)},st=function(t,n,s){return Z(t)?Object.keys(t).reduce(function(a,o){var i=!Z(n)||!Nn(t[o],n[o]);return s.includes(o)?(i&&console.warn("Unsupported prop change: options.".concat(o," is not a mutable property.")),a):i?Oe(Oe({},a||{}),{},nt({},o,t[o])):a},null):null},ot="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",Fe=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot;if(t===null||Cn(t))return t;throw new Error(n)},En=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:ot;if(Sn(t))return{tag:"async",stripePromise:Promise.resolve(t).then(function(a){return Fe(a,n)})};var s=Fe(t,n);return s===null?{tag:"empty"}:{tag:"sync",stripe:s}},_n=function(t){!t||!t._registerWrapper||!t.registerAppInfo||(t._registerWrapper({name:"react-stripe-js",version:"2.7.3"}),t.registerAppInfo({name:"react-stripe-js",version:"2.7.3",url:"https://stripe.com/docs/stripe-js/react"}))},_e=S.createContext(null);_e.displayName="ElementsContext";var An=function(t,n){if(!t)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(n," in an <Elements> provider."));return t},at=function(t){var n=t.stripe,s=t.options,a=t.children,o=S.useMemo(function(){return En(n)},[n]),i=S.useState(function(){return{stripe:o.tag==="sync"?o.stripe:null,elements:o.tag==="sync"?o.stripe.elements(s):null}}),l=rt(i,2),c=l[0],u=l[1];S.useEffect(function(){var f=!0,j=function(y){u(function(E){return E.stripe?E:{stripe:y,elements:y.elements(s)}})};return o.tag==="async"&&!c.stripe?o.stripePromise.then(function(g){g&&f&&j(g)}):o.tag==="sync"&&!c.stripe&&j(o.stripe),function(){f=!1}},[o,c,s]);var m=xe(n);S.useEffect(function(){m!==null&&m!==n&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[m,n]);var p=xe(s);return S.useEffect(function(){if(c.elements){var f=st(s,p,["clientSecret","fonts"]);f&&c.elements.update(f)}},[s,p,c.elements]),S.useEffect(function(){_n(c.stripe)},[c.stripe]),S.createElement(_e.Provider,{value:c},a)};at.propTypes={stripe:w.any,options:w.object};w.func.isRequired;var it=S.createContext(null);it.displayName="CustomCheckoutSdkContext";var wn=function(t,n){if(!t)throw new Error("Could not find CustomCheckoutProvider context; You need to wrap the part of your app that ".concat(n," in an <CustomCheckoutProvider> provider."));return t},kn=S.createContext(null);kn.displayName="CustomCheckoutContext";w.any,w.shape({clientSecret:w.string.isRequired,elementsOptions:w.object}).isRequired;var Be=function(t){var n=S.useContext(it),s=S.useContext(_e);if(n&&s)throw new Error("You cannot wrap the part of your app that ".concat(t," in both <CustomCheckoutProvider> and <Elements> providers."));return n?wn(n,t):An(s,t)},Pn=function(t){return t.charAt(0).toUpperCase()+t.slice(1)},R=function(t,n){var s="".concat(Pn(t),"Element"),a=function(c){var u=c.id,m=c.className,p=c.options,f=p===void 0?{}:p,j=c.onBlur,g=c.onFocus,y=c.onReady,E=c.onChange,h=c.onEscape,k=c.onClick,x=c.onLoadError,_=c.onLoaderStart,v=c.onNetworksChange,P=c.onConfirm,A=c.onCancel,D=c.onShippingAddressChange,C=c.onShippingRateChange,T=Be("mounts <".concat(s,">")),L="elements"in T?T.elements:null,$="customCheckoutSdk"in T?T.customCheckoutSdk:null,N=S.useState(null),Y=rt(N,2),F=Y[0],jt=Y[1],W=S.useRef(null),me=S.useRef(null);M(F,"blur",j),M(F,"focus",g),M(F,"escape",h),M(F,"click",k),M(F,"loaderror",x),M(F,"loaderstart",_),M(F,"networkschange",v),M(F,"confirm",P),M(F,"cancel",A),M(F,"shippingaddresschange",D),M(F,"shippingratechange",C),M(F,"change",E);var fe;y&&(t==="expressCheckout"?fe=y:fe=function(){y(F)}),M(F,"ready",fe),S.useLayoutEffect(function(){if(W.current===null&&me.current!==null&&(L||$)){var U=null;$?U=$.createElement(t,f):L&&(U=L.create(t,f)),W.current=U,jt(U),U&&U.mount(me.current)}},[L,$,f]);var we=xe(f);return S.useEffect(function(){if(W.current){var U=st(f,we,["paymentRequest"]);U&&W.current.update(U)}},[f,we]),S.useLayoutEffect(function(){return function(){if(W.current&&typeof W.current.destroy=="function")try{W.current.destroy(),W.current=null}catch{}}},[]),S.createElement("div",{id:u,className:m,ref:me})},o=function(c){Be("mounts <".concat(s,">"));var u=c.id,m=c.className;return S.createElement("div",{id:u,className:m})},i=n?o:a;return i.propTypes={id:w.string,className:w.string,onChange:w.func,onBlur:w.func,onFocus:w.func,onReady:w.func,onEscape:w.func,onClick:w.func,onLoadError:w.func,onLoaderStart:w.func,onNetworksChange:w.func,onConfirm:w.func,onCancel:w.func,onShippingAddressChange:w.func,onShippingRateChange:w.func,options:w.object},i.displayName=s,i.__elementType=t,i},O=typeof window>"u",In=S.createContext(null);In.displayName="EmbeddedCheckoutProviderContext";R("auBankAccount",O);R("card",O);R("cardNumber",O);R("cardExpiry",O);R("cardCvc",O);R("fpxBank",O);R("iban",O);R("idealBank",O);R("p24Bank",O);R("epsBank",O);R("payment",O);R("expressCheckout",O);R("paymentRequestButton",O);R("linkAuthentication",O);var Rn=R("address",O);R("shippingAddress",O);R("paymentMethodMessaging",O);R("affirmMessage",O);R("afterpayClearpayMessage",O);var ct="https://js.stripe.com/v3",On=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/;var Tn=function(){for(var t=document.querySelectorAll('script[src^="'.concat(ct,'"]')),n=0;n<t.length;n++){var s=t[n];if(On.test(s.src))return s}return null},Le=function(t){var n="",s=document.createElement("script");s.src="".concat(ct).concat(n);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(s),s},Dn=function(t,n){!t||!t._registerWrapper||t._registerWrapper({name:"stripe-js",version:"4.6.0",startTime:n})},ne=null,le=null,ue=null,Fn=function(t){return function(){t(new Error("Failed to load Stripe.js"))}},Bn=function(t,n){return function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))}},Ln=function(t){return ne!==null?ne:(ne=new Promise(function(n,s){if(typeof window>"u"||typeof document>"u"){n(null);return}if(window.Stripe){n(window.Stripe);return}try{var a=Tn();if(!(a&&t)){if(!a)a=Le(t);else if(a&&ue!==null&&le!==null){var o;a.removeEventListener("load",ue),a.removeEventListener("error",le),(o=a.parentNode)===null||o===void 0||o.removeChild(a),a=Le(t)}}ue=Bn(n,s),le=Fn(s),a.addEventListener("load",ue),a.addEventListener("error",le)}catch(i){s(i);return}}),ne.catch(function(n){return ne=null,Promise.reject(n)}))},Mn=function(t,n,s){if(t===null)return null;var a=t.apply(void 0,n);return Dn(a,s),a},re,lt=!1,ut=function(){return re||(re=Ln(null).catch(function(t){return re=null,Promise.reject(t)}),re)};Promise.resolve().then(function(){return ut()}).catch(function(e){lt||console.warn(e)});var Un=function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];lt=!0;var a=Date.now();return ut().then(function(o){return Mn(o,n,a)})};const qn=e=>({address:{firstName:(e==null?void 0:e.first_name)||"",lastName:(e==null?void 0:e.last_name)||"",address1:(e==null?void 0:e.address_1)||"",address2:(e==null?void 0:e.address_2)||"",province:(e==null?void 0:e.province)||"",city:(e==null?void 0:e.city)||"",countryCode:(e==null?void 0:e.country_code)||"us",postalCode:(e==null?void 0:e.postal_code)||"",phone:(e==null?void 0:e.phone)||""},completed:!1}),dt=({title:e,address:t,mode:n,allowedCountries:s=[],setAddress:a})=>{var m;const{env:o}=Xe(),{cart:i}=V(),{region:l}=Ut(),c=p=>{var E,h;const f=((E=p.value.name)==null?void 0:E.split(" "))||[],j=f.slice(0,-1).join(" "),g=f.slice(-1).join(" "),y=p.complete&&!p.value.address.state;a({address:{firstName:p.value.firstName||j||"",lastName:p.value.lastName||g||"",address1:p.value.address.line1,address2:p.value.address.line2??"",province:y?"-":p.value.address.state,city:p.value.address.city,countryCode:(h=p.value.address.country)==null?void 0:h.toLowerCase(),postalCode:p.value.address.postal_code,phone:p.value.phone??""},completed:p.complete})},u=d.useMemo(()=>o.STRIPE_PUBLIC_KEY?Un(o.STRIPE_PUBLIC_KEY):null,[o.STRIPE_PUBLIC_KEY]);return i?r.jsxs("div",{children:[e&&r.jsx("h3",{className:"mt-6 text-sm",children:e}),r.jsx(at,{stripe:u,options:{mode:"setup",currency:l.currency_code,appearance:{variables:{borderRadius:"6px",spacingUnit:"4.601px",fontSizeBase:"16px",colorText:"#374151",fontWeightNormal:"400",fontWeightBold:"700",fontSizeSm:"16px"},rules:{".Input":{fontSize:"1rem",color:"#000000"},".Input:focus":{boxShadow:"inset 0 0 0 1px rgba(210, 213, 218, 1)"},".Label":{FontWeight:"700"}}}},children:r.jsx(Rn,{options:{mode:n,allowedCountries:s,display:{name:"split"},fields:{phone:"always"},validation:{phone:{required:"always"}},defaultValues:{address:{line1:t.address1,line2:t.address2,city:t.city,state:t.province,postal_code:t.postalCode,country:((m=t.countryCode)==null?void 0:m.toUpperCase())||"us"},phone:t.phone,firstName:t.firstName,lastName:t.lastName}},onChange:c})})]}):null},pt=({title:e,address:t,countryOptions:n})=>{var s;return r.jsxs("span",{children:[e&&r.jsx("dt",{className:"mt-6 text-sm font-bold text-gray-700",children:e}),r.jsxs("dd",{className:"mt-0.5",children:[(t==null?void 0:t.company)&&r.jsxs(r.Fragment,{children:[t==null?void 0:t.company,r.jsx("br",{})]}),t==null?void 0:t.address1,r.jsx("br",{}),(t==null?void 0:t.address2)&&r.jsxs(r.Fragment,{children:[t==null?void 0:t.address2,r.jsx("br",{})]}),t==null?void 0:t.city,", ",t==null?void 0:t.province," ",t==null?void 0:t.postalCode,r.jsx("br",{}),(t==null?void 0:t.countryCode)&&r.jsxs(r.Fragment,{children:[(s=n.find(({value:a})=>a===(t==null?void 0:t.countryCode)))==null?void 0:s.label,r.jsx("br",{})]})]})]})},Vn=(e,t)=>{var s,a,o;return e.shipping_address?e.shipping_address:!t||!((s=t==null?void 0:t.addresses)!=null&&s.length)?null:(t!=null&&t.default_shipping_address_id?(a=t.addresses)==null?void 0:a.find(i=>i.id===(t==null?void 0:t.default_shipping_address_id)):(o=t==null?void 0:t.addresses)==null?void 0:o[0])||null},$n="new",Wn=()=>{var P,A,D;const e=H({key:pe.cart.accountDetails}),{customer:t}=Ee(),{regions:n}=qt(),{step:s,setStep:a,goToNextStep:o,cart:i,isCartMutating:l}=V(),c=s===K.ACCOUNT_DETAILS;if(!i)return null;const u=(n??[]).flatMap(C=>C.countries.map(T=>T.iso_2)),m=Vn(i,t),p=Ne(i),f=["submitting","loading"].includes(e.state),j=!!((P=e.data)!=null&&P.errors),g=(m==null?void 0:m.id)??$n,y=((D=(A=i.region)==null?void 0:A.countries)==null?void 0:D.map(C=>({value:C.iso_2,label:C.display_name})))??[],E={cartId:i.id,email:(t==null?void 0:t.email)||i.email||"",customerId:t==null?void 0:t.id,allowSuggestions:!0,shippingAddress:{...Ye(m)},shippingAddressId:g},h=ie({resolver:ae(Ht),defaultValues:E,fetcher:e,submitConfig:{method:"post",action:"/api/checkout/account-details"}}),k=C=>{h.setValue("shippingAddress.address1",C.address.address1??""),h.setValue("shippingAddress.address2",C.address.address2??""),h.setValue("shippingAddress.city",C.address.city??""),h.setValue("shippingAddress.province",C.address.province??""),h.setValue("shippingAddress.countryCode",C.address.countryCode??""),h.setValue("shippingAddress.postalCode",C.address.postalCode??""),h.setValue("shippingAddress.phone",C.address.phone??""),h.setValue("shippingAddress.firstName",C.address.firstName??""),h.setValue("shippingAddress.lastName",C.address.lastName??""),h.setValue("shippingAddress.company",C.address.company??""),h.setValue("shippingAddress.phone",C.address.phone??"")},x=h.watch("shippingAddress");d.useEffect(()=>{c&&!f&&!j&&p&&(h.reset(),o())},[f,p]);const _=()=>{o()},v=p&&!c;return r.jsxs("div",{className:"checkout-account-details",children:[r.jsx(Qe,{completed:v,setStep:a,step:K.ACCOUNT_DETAILS,children:"Account details"}),!c&&p&&r.jsx(pt,{title:"Shipping Address",address:x,countryOptions:y}),c&&r.jsxs(r.Fragment,{children:[t!=null&&t.email?r.jsx("p",{className:"mt-2 text-sm mb-2",children:"To get started, please select your shipping address."}):r.jsx("p",{className:"mt-2 text-sm mb-4",children:"To get started, enter your email address."}),r.jsx(ce,{...h,children:r.jsxs(e.Form,{id:"checkout-account-details-form",onSubmit:h.handleSubmit,children:[r.jsx(z,{type:"hidden",name:"cartId"}),r.jsx(z,{type:"hidden",name:"customerId"}),r.jsx(ve,{name:"email",type:"email",autoComplete:"email",placeholder:"Email address",label:"Email Address",className:"[&_input]:!ring-0 mb-2"}),r.jsx(He,{address:x,prefix:"shippingAddress"}),r.jsx(ve,{type:"hidden",name:"shippingAddressId",value:g}),r.jsx(dt,{mode:"shipping",address:x,allowedCountries:u,setAddress:k}),r.jsx(be,{}),r.jsxs(Rt,{children:[r.jsx(Se,{disabled:f||l,children:f?"Saving...":"Save and continue"}),p&&r.jsx(ee,{disabled:f,onClick:_,children:"Cancel edit"})]})]})})]})]})},Gn="/assets/StripeBadge-D70kF_jj.png",Kn=({className:e})=>r.jsx("img",{className:e,width:320,src:Gn,alt:"stripe security badge"});Ot({page:Pe.number().int().min(0).default(0),pageSize:Pe.number().int().min(1).default(10),sortField:ke().optional(),sortOrder:Tt(["asc","desc"]).default("asc"),dataTableSearch:ke().optional()}).passthrough();const Yn=({shippingOption:e,region:t,value:n})=>{const s=n===e.id;return r.jsx("div",{className:"relative col-span-1",children:r.jsx("label",{htmlFor:e.id,className:"",children:r.jsxs("div",{className:q("group relative flex h-full flex-col justify-between rounded-lg border bg-white p-4 shadow-sm","active:ring-primary-500 hover:border-gray-400 focus:outline-none active:ring-2",s?"border-transparent":"border-gray-300"),children:[r.jsxs("div",{className:"flex justify-between gap-1",children:[r.jsx("div",{className:"block text-sm font-bold text-gray-900",children:e.name}),r.jsx(Dt,{id:e.id,value:e.id,className:"text-primary-600 h-5 w-5 border-0",indicator:r.jsx(Ft,{className:"text-primary-600 h-5 w-5","aria-hidden":"true"})})]}),r.jsx("div",{className:"mt-6 flex items-end justify-between text-sm text-gray-500",children:r.jsx("div",{children:oe(e.amount,{currency:t.currency_code})})}),r.jsx("div",{className:q("pointer-events-none absolute -inset-px rounded-lg border-2 active:border",s?"border-primary-500":"border-transparent"),"aria-hidden":"true"})]})})})},Jn=({name:e,shippingOptions:t,region:n,value:s,onValueChange:a,disabled:o})=>{const i=Ke(),l=i.formState.isSubmitting,c=async u=>{if(!l){a==null||a(u);try{await i.handleSubmit()}catch(m){console.error("Failed to submit shipping option:",m)}}};return t.length?r.jsx(Bt,{name:e,value:s??"",onValueChange:c,className:q("xs:grid-cols-2 my-6 grid grid-cols-1 gap-4",l&&"pointer-events-none"),disabled:l||o,children:t.map(u=>r.jsx(Yn,{shippingOption:u,region:n},u.id))}):r.jsx("div",{children:"No shipping options available"})},zn=(e,t)=>{var s;const n=((s=e.shipping_methods)==null?void 0:s.map(a=>a.shipping_option_id))??[];return Object.values(t).reduce((a,o)=>{const i=o.find(l=>n.includes(l.id));return a.push(i?i.id:o[0].id),a},[])},Qn=(e,t)=>({cartId:e.id,shippingOptionIds:zn(e,t)}),Hn=()=>{var h,k,x;const e=H(),{step:t,shippingOptions:n,setStep:s,goToNextStep:a,cart:o,isCartMutating:i}=V(),l=t===K.PAYMENT,c=["submitting","loading"].includes(e.state);if(!o)return null;const u=!!((h=e.data)!=null&&h.errors),m=Ne(o),p=d.useMemo(()=>Ce(n),[n]),f=d.useMemo(()=>nn(o,n),[o,n]),j=d.useMemo(()=>Qn(o,p),[o,p]),g=ie({resolver:ae(Qt),defaultValues:j,fetcher:e,submitConfig:{method:"post",action:"/api/checkout/shipping-methods"}}),y=g.watch("shippingOptionIds");d.useEffect(()=>{var _;g.setValue("shippingOptionIds",((_=o.shipping_methods)==null?void 0:_.map(v=>v.shipping_option_id))??[])},[o.shipping_methods]),d.useEffect(()=>{l&&!c&&!u&&f&&a()},[c,f]);const E=!l&&m;return r.jsxs("div",{className:"checkout-delivery-method",children:[r.jsx(Qe,{completed:E,setStep:s,step:K.PAYMENT,children:"Delivery & Payment"}),!l&&r.jsxs(r.Fragment,{children:[((k=o.shipping_methods)==null?void 0:k.length)===0&&r.jsx(Kn,{className:"mt-4"}),r.jsx("dl",{children:(x=o.shipping_methods)==null?void 0:x.map((_,v)=>{var T;const{id:P,shipping_option_id:A,amount:D}=_,C=n.find(L=>L.id===A);return r.jsxs(d.Fragment,{children:[r.jsx("dt",{className:`${v>0?"mt-6":"mt-4"} text-sm font-bold text-gray-700`,children:"Delivery method for: All items"}),r.jsxs("dd",{className:"mt-0.5",children:[C==null?void 0:C.name," (",oe(D,{currency:(T=o==null?void 0:o.region)==null?void 0:T.currency_code}),")"]})]},P)})})]}),l&&r.jsx(ce,{...g,children:r.jsxs(e.Form,{children:[r.jsx(z,{type:"hidden",name:"cartId",value:o.id}),Object.entries(p).map(([_,v],P)=>{var A;return v.length<1?null:r.jsxs(d.Fragment,{children:[P>0&&r.jsx("hr",{className:"my-6"}),!!((A=o==null?void 0:o.shipping_methods)!=null&&A.length)&&r.jsx(je,{type:"info",className:"my-6",children:"Choose your delivery option"}),r.jsx(Jn,{disabled:i,name:`shippingOptionIds.${P}`,shippingOptions:v,region:o.region,value:(y==null?void 0:y[P])??null,onValueChange:D=>g.setValue(`shippingOptionIds.${P}`,D)})]},_)})]})})]})},Xn=({formId:e,item:t,className:n,maxInventory:s=10,...a})=>{const o=H({key:pe.cart.updateLineItem}),i=["submitting","loading"].includes(o.state),l=ie({resolver:ae(Xt),defaultValues:{lineItemId:t.id,quantity:t.quantity.toString()},fetcher:o,submitConfig:{method:"post",action:"/api/cart/line-items/update"}}),c=u=>{o.submit({lineItemId:t.id,quantity:u},{method:"post",action:"/api/cart/line-items/update"})};return r.jsx(ce,{...l,children:r.jsx(o.Form,{id:e,className:q("line-item-quantity-select",n),...a,onSubmit:l.handleSubmit,children:r.jsx(Jt,{formId:e,className:q({"pointer-events-none opacity-50":i}),variant:t.variant,onChange:c})})})},Zn=({item:e,name:t})=>{var i,l,c;const{cart:n}=V(),s=Vt(),a=()=>s.submit(e),o=["loading","submitting"].includes(s.state);return n?r.jsxs("li",{className:"flex px-4 py-6 sm:px-6",children:[r.jsx("div",{className:"flex-shrink-0",children:r.jsx(Kt,{src:((l=(i=e.variant)==null?void 0:i.product)==null?void 0:l.thumbnail)||"",alt:e.product_title||"product thumbnail",className:"w-20 rounded-md"})}),r.jsxs("div",{className:"ml-6 flex flex-1 flex-col",children:[r.jsxs("div",{className:"flex",children:[r.jsxs("div",{className:"min-w-0 flex-1",children:[r.jsx("h4",{className:"text-base",children:r.jsx(We,{to:`/products/${e.product_handle}`,className:"font-bold text-gray-700 hover:text-gray-800",children:e.product_title})}),r.jsx("p",{className:"mt-0.5 text-sm text-gray-500",children:e.variant_title})]}),r.jsx("div",{className:"ml-4 flow-root flex-shrink-0",children:r.jsx(ee,{variant:"link",onClick:a,disabled:o,className:"text-sm",children:o?"Removing":"Remove"})})]}),r.jsxs("div",{className:"flex flex-1 items-end justify-between pt-2",children:[r.jsx("div",{className:"mr-4",children:r.jsx(Xn,{formId:`quantity-${t}-${e.id}`,item:e})}),r.jsx("p",{className:"mt-1 text-lg",children:r.jsx("span",{className:"font-bold text-gray-900",children:oe(e.unit_price,{currency:(c=n.region)==null?void 0:c.currency_code})})})]})]})]}):null},er=({cart:e,name:t})=>{var n;return r.jsx("ul",{role:"list",className:"divide-y divide-gray-200",children:(n=e.items)==null?void 0:n.map(s=>r.jsx(Zn,{item:s,name:t},s.id))})},tr=({cart:e,promotion:t})=>{const n=H({key:pe.cart.removePromotionCode});return["submitting","loading"].includes(n.state)?null:r.jsxs(n.Form,{method:"post",action:"/api/checkout/remove-discount-code",children:[r.jsx("input",{type:"hidden",name:"cartId",value:e.id}),r.jsx("input",{type:"hidden",name:"code",value:t.code}),r.jsxs("button",{className:"focus:ring-primary-100 focus:border-primary-100 inline-flex h-8 items-center rounded-md border border-gray-300 bg-white px-2 text-xs font-bold text-gray-900 shadow-sm hover:bg-gray-100",children:[r.jsx("span",{children:t.code}),r.jsx("div",{className:"ml-[4px] inline-block text-gray-400",children:r.jsx($t,{className:"inline-block h-4 w-4 leading-none"})})]})]})},nr=({cart:e})=>{var p,f,j;const t=d.useRef(null),n=d.useRef(null),s=H(),[a,o]=d.useState(!!e.promotions.length),i=!!((p=e.promotions)!=null&&p.length),l=Object.keys(((f=s.data)==null?void 0:f.errors)||{}).length>0,c=["submitting","loading"].includes(s.state),u=ie({resolver:ae(Zt),defaultValues:{cartId:e.id,code:""},fetcher:s,submitConfig:{method:"post",action:"/api/checkout/discount-code"}});d.useEffect(()=>{var g;!c&&!l&&(u.reset(),(g=n.current)==null||g.focus())},[c,l]);const m=()=>{o(!0),setTimeout(()=>{var g;return(g=n.current)==null?void 0:g.focus()},0)};return r.jsxs("div",{className:"mb-6",children:[!a&&r.jsx("div",{children:r.jsx(zt,{size:"sm",onClick:m,children:"Add promo code"})}),a&&r.jsxs(r.Fragment,{children:[r.jsx(ce,{...u,children:r.jsxs(s.Form,{ref:t,onSubmit:u.handleSubmit,children:[r.jsx("input",{type:"hidden",name:"cartId",value:e.id}),r.jsxs("div",{className:"!my-0 !flex items-start gap-1",children:[r.jsx(ve,{name:"code",className:"flex-grow",placeholder:"Discount code","aria-label":"discount code"}),r.jsx(Se,{type:"submit",className:"flex-shrink-0 flex-grow-0",disabled:c,children:c?"Applying...":"Apply"})]}),r.jsx(be,{})]})}),i&&r.jsx("div",{className:"mt-2",children:(j=e.promotions)==null?void 0:j.map(g=>r.jsx(tr,{cart:e,promotion:g},g.id))})]})]})},X=({label:e,amount:t,className:n,region:s})=>r.jsxs("div",{className:q("flex items-center justify-between text-sm",n),children:[r.jsx("dt",{children:e}),r.jsx("dd",{className:"font-bold text-gray-900",children:oe(t||0,{currency:s==null?void 0:s.currency_code})})]}),rr=({shippingOptions:e,cart:t})=>{const s=(t.shipping_methods||[]).length>0,a=rn(e),o=t.discount_total??0,i=t.shipping_total??0,l=t.total??0,c=s?l:l+a;return r.jsxs("div",{className:"border-t border-gray-200 px-4 py-6 sm:px-6",children:[r.jsx(nr,{cart:t}),r.jsxs("dl",{className:"flex flex-col gap-2",children:[r.jsx(X,{label:"Subtotal",amount:t.item_subtotal,region:t.region}),o>0&&r.jsx(X,{label:"Discount",amount:-o,region:t.region}),s&&r.jsx(X,{label:"Shipping",amount:i,region:t.region}),!s&&r.jsx(X,{label:"Estimated Shipping",amount:a,region:t.region}),r.jsx(X,{label:"Taxes",amount:t.tax_total,region:t.region}),r.jsx(X,{label:"Total",amount:c,className:"border-t border-gray-200 pt-6 !text-xl",region:t.region})]})]})},mt=({submitButton:e,name:t})=>{const{shippingOptions:n,cart:s}=V();return s?r.jsxs("div",{className:"my-0 rounded-lg border border-gray-200 bg-white shadow-sm",children:[r.jsx("h3",{className:"sr-only",children:"Items in your cart"}),r.jsx(er,{cart:s,name:t}),r.jsx(rr,{cart:s,shippingOptions:n}),e&&r.jsx("div",{className:"border-t border-gray-200 p-4 sm:p-6",children:e})]}):null},ft=({id:e,submitMessage:t,onSubmit:n,paymentMethods:s,children:a,providerId:o,className:i})=>{var L,$;const{activePaymentSession:l,cart:c,isCartMutating:u}=V(),m=H({key:pe.cart.completeCheckout}),[p,f]=d.useState(!1),j=["submitting","loading"].includes(m.state)||p,g=s.filter(N=>N.provider_id===o),y=g.length>0,E=y?g[0].data.id:"new";if(!c)return null;const h=Ye(c.billing_address),k=qn(c==null?void 0:c.shipping_address)??ge,x=(($=(L=c.region)==null?void 0:L.countries)==null?void 0:$.map(N=>({value:N.iso_2,label:N.display_name})))??[],_={cartId:c.id,paymentMethodId:E,sameAsShipping:!0,billingAddress:h,providerId:o},v=ie({resolver:ae(on),defaultValues:_,fetcher:m,submitConfig:{method:"post",action:"/api/checkout/complete"}}),P=v.watch("sameAsShipping"),A=v.watch("billingAddress"),D=async N=>{N.preventDefault(),f(!0);const Y=v.getValues();return typeof n=="function"?await n(Y,N,{setSubmitting:f,submit:()=>v.handleSubmit()}):v.handleSubmit()},C=N=>{v.setValue("billingAddress.address1",N.address.address1??""),v.setValue("billingAddress.address2",N.address.address2??""),v.setValue("billingAddress.city",N.address.city??""),v.setValue("billingAddress.province",N.address.province??""),v.setValue("billingAddress.countryCode",N.address.countryCode??""),v.setValue("billingAddress.postalCode",N.address.postalCode??""),v.setValue("billingAddress.phone",N.address.phone??""),v.setValue("billingAddress.firstName",N.address.firstName??""),v.setValue("billingAddress.lastName",N.address.lastName??""),v.setValue("billingAddress.company",N.address.company??""),v.setValue("billingAddress.phone",N.address.phone??"")},T=()=>r.jsx(Se,{form:e,className:"w-full lg:w-auto",disabled:j||u||!P&&!A,children:j?"Confirming...":t??"Confirm & Pay"});return l?r.jsx(r.Fragment,{children:r.jsxs(ce,{...v,children:[r.jsxs(m.Form,{id:e,onSubmit:D,className:i,children:[r.jsx(z,{type:"hidden",name:"cartId",value:c.id}),r.jsx(z,{type:"hidden",name:"providerId",value:o}),r.jsx("h3",{className:"text-lg font-bold text-gray-900",children:"Billing address"}),r.jsx(en,{className:"my-4",name:"sameAsShipping",label:"Same as shipping address"}),!P&&r.jsx(dt,{mode:"billing",address:A,setAddress:C}),r.jsx(He,{address:A,prefix:"billingAddress"}),P&&r.jsx("div",{className:"-mt-2 mb-4",children:r.jsx(pt,{address:k.address,countryOptions:x})}),!y&&r.jsx("input",{type:"hidden",name:"paymentMethodId",value:"new"}),r.jsx("div",{className:`stripe-payment-form ${E!=="new"?"hidden":""}`,children:a}),r.jsx(be,{})]}),r.jsx("div",{className:"block lg:hidden",children:r.jsx(mt,{name:"checkout",submitButton:r.jsx(T,{})})}),r.jsx("div",{className:"hidden lg:block",children:r.jsx(T,{})})]})}):null},sr=e=>r.jsx(ft,{providerId:"pp_system_default",id:"TestPaymentForm",submitMessage:"Complete Order",className:"mt-4",...e}),or=({isActiveStep:e,paymentMethods:t})=>{var h,k;const{cart:n}=V(),[s,a]=d.useState([]),[o,i]=d.useState(""),[l,c]=d.useState(null),[u,m]=d.useState(!1),[p,f]=d.useState(null),[j,g]=d.useState(!1),y=H();d.useEffect(()=>{y.state==="idle"&&!y.data&&y.load("/api/bank-accounts")},[]),d.useEffect(()=>{var x;(x=y.data)!=null&&x.bank_accounts&&(a(y.data.bank_accounts),y.data.bank_accounts.length>0&&!o&&i(y.data.bank_accounts[0].id))},[y.data]),d.useEffect(()=>{var x;if((x=n==null?void 0:n.payment_collection)!=null&&x.payment_sessions){const _=n.payment_collection.payment_sessions.find(v=>v.provider_id==="pp_bank_transfer_bank_transfer");if(_&&_.data){const v=_.data;if(v.bank_account_id){const P=v.bank_account_id;if(i(P),s.length>0){const A=s.find(D=>D.id===P);if(A){c({id:A.id,bankName:A.name,accountHolder:A.account_holder,accountNumber:A.account_number,bankCode:A.bank_code,swiftCode:A.swift_code||void 0,qrCodeUrl:A.qr_code_url||void 0});return}}}}}c(null)},[(h=n==null?void 0:n.payment_collection)==null?void 0:h.payment_sessions,s]);const E=async()=>{try{if(m(!0),f(null),!n)throw new Error("Cart not found");if(!o)throw new Error("Please select a bank account");const x=new FormData;x.append("provider_id","pp_bank_transfer_bank_transfer"),x.append("bank_account_id",o);const _=await fetch("/api/checkout/payment-session",{method:"POST",body:x});if(!_.ok){const v=await _.json().catch(()=>({}));throw new Error(v.message||"Failed to select bank transfer payment")}window.location.reload()}catch(x){f(x.message||"Failed to select bank transfer payment"),m(!1)}};return r.jsxs("div",{className:"bank-transfer-payment space-y-4",children:[p&&r.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:p}),l?r.jsxs("div",{className:"space-y-6 bg-gray-50 p-6 rounded-lg",children:[r.jsxs("div",{className:"space-y-4",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Bank Transfer Details"}),r.jsxs("div",{className:"space-y-3 bg-white p-4 rounded border border-gray-200",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"Bank:"}),r.jsx("span",{className:"text-gray-800",children:l.bankName})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"Account Holder:"}),r.jsx("span",{className:"text-gray-800",children:l.accountHolder})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"Account Number:"}),r.jsx("span",{className:"text-gray-800 font-mono",children:l.accountNumber})]}),r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"Bank Code:"}),r.jsx("span",{className:"text-gray-800 font-mono",children:l.bankCode})]}),l.swiftCode&&r.jsxs("div",{className:"flex justify-between",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"SWIFT Code:"}),r.jsx("span",{className:"text-gray-800 font-mono",children:l.swiftCode})]}),r.jsxs("div",{className:"flex justify-between pt-2 border-t",children:[r.jsx("span",{className:"text-gray-600 font-medium",children:"Amount to Pay:"}),r.jsx("span",{className:"text-lg font-bold text-green-600",children:oe((n==null?void 0:n.total)||0,{currency:(k=n==null?void 0:n.region)==null?void 0:k.currency_code})})]})]})]}),l.qrCodeUrl&&r.jsx("div",{className:"space-y-4",children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:"Payment QR Code"}),r.jsx("button",{type:"button",onClick:()=>g(!j),className:"text-blue-600 hover:text-blue-800 text-sm font-medium",children:j?"Hide":"Show"})]})}),r.jsxs("div",{className:"bg-blue-50 border border-blue-200 p-4 rounded space-y-2",children:[r.jsx("h4",{className:"font-semibold text-blue-900",children:"Payment Instructions:"}),r.jsxs("ol",{className:"list-decimal list-inside text-sm text-blue-800 space-y-1",children:[r.jsx("li",{children:"Log into your bank account"}),r.jsx("li",{children:"Create a transfer to the account details shown above"}),r.jsx("li",{children:"Use your Order ID as the reference/memo"}),r.jsx("li",{children:"Transfer the exact amount shown"}),r.jsx("li",{children:"The admin will verify your payment and update your order status"})]})]}),r.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Your order will be marked as pending payment until verified by admin."})]}):r.jsxs("div",{className:"space-y-4",children:[r.jsx("p",{className:"text-gray-600",children:"Select a bank account and then choose Bank Transfer to pay via bank wire. You'll receive payment instructions after placing the order."}),s.length>0?r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{htmlFor:"bank-account",className:"block text-sm font-medium text-gray-700",children:"Select Bank Account"}),r.jsx("select",{id:"bank-account",value:o,onChange:x=>i(x.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-blue-500",children:s.map(x=>r.jsxs("option",{value:x.id,children:[x.name," - ",x.account_number]},x.id))})]}),r.jsx(ee,{onClick:E,disabled:!o||u,className:"w-full bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed",children:u?"Processing...":"Select Bank Transfer"})]}):r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded",children:"No bank accounts available. Please contact support."})]}),l&&r.jsx(ft,{providerId:"pp_bank_transfer_bank_transfer",id:"BankTransferCheckoutForm",submitMessage:"Complete Order",className:"mt-4",paymentMethods:t})]})},Me={update:async e=>{const t=await fetch("/api/checkout/express",{method:"POST",body:ye(e)});return t.ok?[await t.json(),null]:[null,new Error("Failed to update shipping address")]}};/*!
 * react-paypal-js v8.9.2 (2025-10-02T20:17:55.069Z)
 * Copyright 2020-present, PayPal, Inc. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * https://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var B;(function(e){e.INITIAL="initial",e.PENDING="pending",e.REJECTED="rejected",e.RESOLVED="resolved"})(B||(B={}));var G;(function(e){e.LOADING_STATUS="setLoadingStatus",e.RESET_OPTIONS="resetOptions",e.SET_BRAINTREE_INSTANCE="braintreeInstance"})(G||(G={}));var Ue;(function(e){e.NUMBER="number",e.CVV="cvv",e.EXPIRATION_DATE="expirationDate",e.EXPIRATION_MONTH="expirationMonth",e.EXPIRATION_YEAR="expirationYear",e.POSTAL_CODE="postalCode"})(Ue||(Ue={}));var I=function(){return I=Object.assign||function(t){for(var n,s=1,a=arguments.length;s<a;s++){n=arguments[s];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},I.apply(this,arguments)};function ht(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]]);return n}function qe(e,t,n){if(n||arguments.length===2)for(var s=0,a=t.length,o;s<a;s++)(o||!(s in t))&&(o||(o=Array.prototype.slice.call(t,0,s)),o[s]=t[s]);return e.concat(o||Array.prototype.slice.call(t))}var se="data-react-paypal-script-id",J={DATA_JS_SDK_LIBRARY:"dataJsSdkLibrary",DATA_LIBRARY_VALUE:"react-paypal-js",DATA_NAMESPACE:"dataNamespace",DATA_SDK_INTEGRATION_SOURCE:"dataSdkIntegrationSource"},ar="Failed to load the PayPal JS SDK script.",yt="paypal",ir="usePayPalScriptReducer must be used within a PayPalScriptProvider";function cr(e){return e===void 0&&(e=yt),window[e]}function lr(e){for(var t="",n=0;n<e.length;n++){var s=e[n].charCodeAt(0)*n;e[n+1]&&(s+=e[n+1].charCodeAt(0)*(n-1)),t+=String.fromCharCode(97+Math.abs(s)%26)}return t}function ur(e){var t=e.reactComponentName,n=e.sdkComponentKey,s=e.sdkRequestedComponents,a=s===void 0?"":s,o=e.sdkDataNamespace,i=o===void 0?yt:o,l=n.charAt(0).toUpperCase().concat(n.substring(1)),c="Unable to render <".concat(t," /> because window.").concat(i,".").concat(l," is undefined."),u=typeof a=="string"?a:a.join(",");if(!u.includes(n)){var m=[u,n].filter(Boolean).join();c+=`
To fix the issue, add '`.concat(n,"' to the list of components passed to the parent PayPalScriptProvider:")+"\n`<PayPalScriptProvider options={{ components: '".concat(m,"'}}>`.")}return c}function gt(e){var t=e,n=se;t[n];var s=ht(t,[n+""]);return"react-paypal-js-".concat(lr(JSON.stringify(s)))}function dr(e){var t=self.document.querySelector("script[".concat(se,'="').concat(e,'"]'));t!=null&&t.parentNode&&t.parentNode.removeChild(t)}function pr(e,t){var n,s;switch(t.type){case G.LOADING_STATUS:return typeof t.value=="object"?I(I({},e),{loadingStatus:t.value.state,loadingStatusErrorMessage:t.value.message}):I(I({},e),{loadingStatus:t.value});case G.RESET_OPTIONS:return dr(e.options[se]),I(I({},e),{loadingStatus:B.PENDING,options:I(I((n={},n[J.DATA_SDK_INTEGRATION_SOURCE]=J.DATA_LIBRARY_VALUE,n),t.value),(s={},s[se]="".concat(gt(t.value)),s))});case G.SET_BRAINTREE_INSTANCE:return I(I({},e),{braintreePayPalCheckoutInstance:t.value});default:return e}}var vt=d.createContext(null);function mr(e){if(typeof(e==null?void 0:e.dispatch)=="function"&&e.dispatch.length!==0)return e;throw new Error(ir)}function fr(){var e=mr(d.useContext(vt)),t=I(I({},e),{isInitial:e.loadingStatus===B.INITIAL,isPending:e.loadingStatus===B.PENDING,isResolved:e.loadingStatus===B.RESOLVED,isRejected:e.loadingStatus===B.REJECTED});return[t,e.dispatch]}d.createContext({});function hr(e){var t=d.useRef(new Proxy({},{get:function(n,s,a){return typeof n[s]=="function"?function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return n[s].apply(n,o)}:Reflect.get(n,s,a)}}));return t.current=Object.assign(t.current,e),t.current}var Ae=function(e){var t,n=e.className,s=n===void 0?"":n,a=e.disabled,o=a===void 0?!1:a,i=e.children,l=e.forceReRender,c=l===void 0?[]:l,u=ht(e,["className","disabled","children","forceReRender"]),m=o?{opacity:.38}:{},p="".concat(s," ").concat(o?"paypal-buttons-disabled":"").trim(),f=d.useRef(null),j=d.useRef(null),g=hr(u),y=fr()[0],E=y.isResolved,h=y.options,k=d.useState(null),x=k[0],_=k[1],v=d.useState(!0),P=v[0],A=v[1],D=d.useState(null),C=D[1];function T(){j.current!==null&&j.current.close().catch(function(){})}return!((t=j.current)===null||t===void 0)&&t.updateProps&&j.current.updateProps({message:u.message}),d.useEffect(function(){if(E===!1)return T;var L=cr(h.dataNamespace);if(L===void 0||L.Buttons===void 0)return C(function(){throw new Error(ur({reactComponentName:Ae.displayName,sdkComponentKey:"buttons",sdkRequestedComponents:h.components,sdkDataNamespace:h[J.DATA_NAMESPACE]}))}),T;var $=function(N,Y){_(Y),typeof u.onInit=="function"&&u.onInit(N,Y)};try{j.current=L.Buttons(I(I({},g),{onInit:$}))}catch(N){return C(function(){throw new Error("Failed to render <PayPalButtons /> component. Failed to initialize:  ".concat(N))})}return j.current.isEligible()===!1?(A(!1),T):(f.current&&j.current.render(f.current).catch(function(N){f.current===null||f.current.children.length===0||C(function(){throw new Error("Failed to render <PayPalButtons /> component. ".concat(N))})}),T)},qe(qe([E],c,!0),[u.fundingSource],!1)),d.useEffect(function(){x!==null&&(o===!0?x.disable().catch(function(){}):x.enable().catch(function(){}))},[o,x]),S.createElement(S.Fragment,null,P?S.createElement("div",{ref:f,style:m,className:p}):i)};Ae.displayName="PayPalButtons";function yr(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]]);return n}function gr(e,t){var n=document.querySelector('script[src="'.concat(e,'"]'));if(n===null)return null;var s=xt(e,t),a=n.cloneNode();if(delete a.dataset.uidAuto,Object.keys(a.dataset).length!==Object.keys(s.dataset).length)return null;var o=!0;return Object.keys(a.dataset).forEach(function(i){a.dataset[i]!==s.dataset[i]&&(o=!1)}),o?n:null}function vr(e){var t=e.url,n=e.attributes,s=e.onSuccess,a=e.onError,o=xt(t,n);o.onerror=a,o.onload=s,document.head.insertBefore(o,document.head.firstElementChild)}function xr(e){var t=e.sdkBaseUrl,n=e.environment,s=yr(e,["sdkBaseUrl","environment"]),a=t||Sr(n),o=s,i=Object.keys(o).filter(function(u){return typeof o[u]<"u"&&o[u]!==null&&o[u]!==""}).reduce(function(u,m){var p=o[m].toString();return m=br(m),m.substring(0,4)==="data"||m==="crossorigin"?u.attributes[m]=p:u.queryParams[m]=p,u},{queryParams:{},attributes:{}}),l=i.queryParams,c=i.attributes;return l["merchant-id"]&&l["merchant-id"].indexOf(",")!==-1&&(c["data-merchant-id"]=l["merchant-id"],l["merchant-id"]="*"),{url:"".concat(a,"?").concat(jr(l)),attributes:c}}function br(e){var t=function(n,s){return(s?"-":"")+n.toLowerCase()};return e.replace(/[A-Z]+(?![a-z])|[A-Z]/g,t)}function jr(e){var t="";return Object.keys(e).forEach(function(n){t.length!==0&&(t+="&"),t+=n+"="+e[n]}),t}function Sr(e){return e==="sandbox"?"https://www.sandbox.paypal.com/sdk/js":"https://www.paypal.com/sdk/js"}function xt(e,t){t===void 0&&(t={});var n=document.createElement("script");return n.src=e,Object.keys(t).forEach(function(s){n.setAttribute(s,t[s]),s==="data-csp-nonce"&&n.setAttribute("nonce",t["data-csp-nonce"])}),n}function Cr(e,t){if(t===void 0&&(t=Promise),bt(e,t),typeof document>"u")return t.resolve(null);var n=xr(e),s=n.url,a=n.attributes,o=a["data-namespace"]||"paypal",i=Ve(o);return a["data-js-sdk-library"]||(a["data-js-sdk-library"]="paypal-js"),gr(s,a)&&i?t.resolve(i):Nr({url:s,attributes:a},t).then(function(){var l=Ve(o);if(l)return l;throw new Error("The window.".concat(o," global variable is not available."))})}function Nr(e,t){t===void 0&&(t=Promise),bt(e,t);var n=e.url,s=e.attributes;if(typeof n!="string"||n.length===0)throw new Error("Invalid url.");if(typeof s<"u"&&typeof s!="object")throw new Error("Expected attributes to be an object.");return new t(function(a,o){if(typeof document>"u")return a();vr({url:n,attributes:s,onSuccess:function(){return a()},onError:function(){var i=new Error('The script "'.concat(n,'" failed to load. Check the HTTP status code and response body in DevTools to learn more.'));return o(i)}})})}function Ve(e){return window[e]}function bt(e,t){if(typeof e!="object"||e===null)throw new Error("Expected an options object.");var n=e.environment;if(n&&n!=="production"&&n!=="sandbox")throw new Error('The `environment` option must be either "production" or "sandbox".');if(typeof t<"u"&&typeof t!="function")throw new Error("Expected PromisePonyfill to be a function.")}var Er=function(e){var t,n=e.options,s=n===void 0?{clientId:"test"}:n,a=e.children,o=e.deferLoading,i=o===void 0?!1:o,l=d.useReducer(pr,{options:I(I({},s),(t={},t[J.DATA_JS_SDK_LIBRARY]=J.DATA_LIBRARY_VALUE,t[J.DATA_SDK_INTEGRATION_SOURCE]=J.DATA_LIBRARY_VALUE,t[se]="".concat(gt(s)),t)),loadingStatus:i?B.INITIAL:B.PENDING}),c=l[0],u=l[1];return d.useEffect(function(){if(i===!1&&c.loadingStatus===B.INITIAL)return u({type:G.LOADING_STATUS,value:B.PENDING});if(c.loadingStatus===B.PENDING){var m=!0;return Cr(c.options).then(function(){m&&u({type:G.LOADING_STATUS,value:B.RESOLVED})}).catch(function(p){console.error("".concat(ar," ").concat(p)),m&&u({type:G.LOADING_STATUS,value:{state:B.REJECTED,message:String(p)}})}),function(){m=!1}}},[c.options,i,c.loadingStatus]),S.createElement(vt.Provider,{value:I(I({},c),{dispatch:u})},a)};function $e(){}d.createContext({cardFieldsForm:null,fields:{},registerField:$e,unregisterField:$e});function _r(){const e=Nt(),{paymentProviders:t,step:n,cart:s}=V();if(!s)return null;const[a,o]=d.useState(null),[i,l]=d.useState(s),c=n===K.PAYMENT,u=d.useMemo(()=>t==null?void 0:t.some(g=>{var y;return(y=g.id)==null?void 0:y.includes("paypal")}),[t]),m=d.useMemo(()=>({clientId:"AUvtGlVenK_bQoUrek0Nl43oRCDETrBjP2ZlhRQcdBuJp1Pt16gSaitZV3aXAhUFIIQBGY29PqKhncLq",components:"buttons",intent:"capture",currency:(i.currency_code||"USD").toUpperCase()}),[i.currency_code]);if(d.useEffect(()=>{l(s)},[s]),!i||!u)return null;const p={borderRadius:10},f=async()=>{var k,x,_;const[g,y]=await Me.update({cartId:i.id,complete:!1});if(y)return o({title:"Error updating account details",description:y.message}),"";const h=(x=(k=g.cart.payment_collection)==null?void 0:k.payment_sessions)==null?void 0:x[0];return((_=h==null?void 0:h.data)==null?void 0:_.id)||""},j=async(g,y)=>{try{if(!(y!=null&&y.order))return;const[E,h]=await Me.update({cartId:i.id,complete:!0});if(h){o({title:"Payment failed",description:h.message});return}const{order:k}=E;if(!k){o({title:"Payment failed",description:"Error trying to complete checkout."});return}e(`/checkout/success?order_id=${k.id}`)}catch(E){const h=E instanceof Error?E.message:"Error trying to submit payment.";o({title:"Payment failed",description:h})}};return r.jsxs("div",{className:q("App",!c&&"hidden"),children:[a?r.jsx(je,{type:"error",title:a.title,className:"mt-4",children:a.description}):null,r.jsx("div",{className:"py-4 relative z-0",children:r.jsx(Er,{options:m,children:r.jsx(Ae,{style:p,createOrder:f,onApprove:j,onError:g=>{const y=g instanceof Error?g.message:"PayPal error";o({title:"Payment failed",description:y})}})})})]})}const Ar=()=>{Xe();const{step:e,paymentProviders:t,cart:n}=V(),s=e===K.PAYMENT;if(console.log(t),!n)return null;const a=d.useMemo(()=>t==null?void 0:t.some(u=>u.id.includes("pp_paypal_paypal")),[t]),o=d.useMemo(()=>!!(t!=null&&t.some(u=>u.id.includes("pp_system_default"))),[t]),i=d.useMemo(()=>!!(t!=null&&t.some(u=>u.id.includes("pp_bank_transfer_bank_transfer"))),[t]),l=[{id:"pp_paypal_paypal",label:"PayPal",component:_r,isActive:a},{id:"pp_bank_transfer_bank_transfer",label:"Bank Transfer",component:or,isActive:i},{id:"pp_system_default",label:"Cash on Delivery",component:sr,isActive:o}],c=d.useMemo(()=>l.filter(u=>u.isActive),[l]);return r.jsx("div",{className:"checkout-payment",children:r.jsx("div",{className:q({"h-0 overflow-hidden opacity-0":!s}),children:r.jsxs(te.Group,{children:[c.length>1&&r.jsx(te.List,{className:"bg-primary-50 mb-2 mt-6 inline-flex gap-0.5 rounded-full p-2",children:c.map((u,m)=>r.jsx(te,{as:ee,className:({selected:p})=>q("!rounded-full",{"!bg-white !text-gray-700 shadow-sm":p,"!bg-primary-50 !border-primary-100 !text-primary-600 hover:!text-primary-800 hover:!bg-primary-100 !border-none":!p}),children:u.label},u.id))}),r.jsx(te.Panels,{children:c.map(u=>{const m=u.component;return r.jsx(te.Panel,{children:r.jsx(m,{isActiveStep:s,paymentMethods:[]})},u.id)})})]})})})},wr=()=>{const{customer:e}=Ee(),{goToNextStep:t,cart:n}=V(),s=!!(e!=null&&e.id);if(n)return d.useEffect(()=>(s&&t(),()=>t()),[s]),r.jsx(r.Fragment,{children:r.jsxs("div",{className:"lg:min-h-[calc(100vh-320px)] lg:pl-8",children:[s&&r.jsxs(je,{type:"info",className:"mb-8",children:["Checking out as:"," ",r.jsxs("strong",{className:"font-bold",children:[e.first_name," ",e.last_name," (",e.email,")"]})]}),r.jsx(Wn,{}),r.jsx("hr",{className:"my-10"}),r.jsx(Hn,{}),r.jsx(Ar,{})]})})},kr=()=>{const{step:e}=V();return r.jsx("div",{className:q("h-full",{"hidden lg:block":e===K.PAYMENT}),children:r.jsx("div",{className:"sticky top-24",children:r.jsx(mt,{name:"sidebar"})})})},Pr=({icon:e,title:t,description:n,action:s})=>r.jsxs("div",{className:"py-16 text-center",children:[e&&r.jsx("div",{className:"inline-block text-gray-300",children:r.jsx(e,{className:"h-10 w-10"})}),r.jsx("h2",{className:"mt-2 text-lg font-bold text-gray-900",children:t}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:n}),s&&r.jsx("div",{className:"mt-6",children:s})]}),Kr=Et(function(){var o;const{shippingOptions:t,paymentProviders:n,activePaymentSession:s,cart:a}=_t();return!a||!((o=a.items)!=null&&o.length)?r.jsx(Pr,{icon:Wt,title:"No items in your cart.",description:"Add items to your cart",action:r.jsx(ee,{variant:"primary",as:i=>r.jsx(We,{to:"/products",...i}),children:"Start shopping"})}):r.jsx(ln,{data:{cart:a,activePaymentSession:s,shippingOptions:t,paymentProviders:n},children:r.jsx("section",{children:r.jsx("div",{className:"mx-auto max-w-2xl px-4 pb-8 pt-6 sm:px-6 sm:pb-16 sm:pt-8 lg:max-w-7xl lg:px-8 lg:pb-24 lg:pt-16",children:r.jsxs("div",{className:"lg:grid lg:grid-cols-[4fr_3fr] lg:gap-x-12 xl:gap-x-16",children:[r.jsx(wr,{}),r.jsx(kr,{})]})})})})});export{Kr as default};
