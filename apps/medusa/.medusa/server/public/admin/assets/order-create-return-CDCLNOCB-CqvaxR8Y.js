import{R as Ae}from"./chunk-P3DRE4IY-CWO08Z7v.js";import{M as Me}from"./chunk-NNBHHXXN-B_BGjoVN.js";import{g as ce}from"./chunk-PXZ7QYKX-DZ_CHK12.js";import{m as Te,c as De,n as He,u as Le,o as Fe,p as ze,q as Ve,s as Be,t as Oe,v as Ue,w as $e}from"./chunk-ICR3D7SB-Dv7djnqf.js";import{D as Qe}from"./chunk-7I5DQGWY-CwOWioty.js";import{a as z}from"./chunk-PDWBYQOW-Dmlh1vBq.js";import{P as Ge,a as Je}from"./chunk-IQBAUTU5-D9ziTGCt.js";import{Z as Xe,u as Ke,b as L,b1 as Ze,b2 as We,r as j,j as e,t as J,dj as Ye,af as et,ag as tt,x as st,H as te,B as G,w as m,K as V,E as W,ai as nt,aj as q,s as it,dn as rt,aM as at,I as se,A as lt,dp as ot,Q as ne,f as dt,J as ie}from"./index-D2KVo1a8.js";import{u as ct,_ as ut}from"./chunk-O6K7WXYN-Bd9nFTPK.js";import"./lodash-DkMG8eL0.js";import{C as Y}from"./chunk-GZBFGV7Y-CXE6t3FD.js";import{c as mt}from"./chunk-MWVM4TYO-bKUcYSnf.js";import"./chunk-CIE5NZAY-CrQxEowX.js";import{u as pt}from"./chunk-C76H5USB-Bci7QLIl.js";import{K as ft}from"./chunk-6HTZNHPT-D3kFaqe6.js";import{R as E,u as xt,a as ht,S as F}from"./chunk-ZCO6EK4W-DnD4xAnr.js";import{u as gt}from"./chunk-GRT22PE5-B-dFuEc5.js";import{u as _t}from"./use-prompt-BBee375y.js";import{P as bt}from"./pencil-square-C70TSvEV.js";import{C as jt}from"./currency-input-BOZzcw-K.js";import{D as yt}from"./document-text-n7llnJ5-.js";import{X as vt}from"./x-circle-T-gYTjKr.js";import{A as Nt}from"./alert-CdZNZU9I.js";import"./Trans-K2aewIgt.js";import"./chunk-P3UUX2T6-CXxEp9PD.js";import"./chunk-YEDAFXMB-CIxOWZGH.js";import"./chunk-AOFGTNG6-kDnuiOdq.js";import"./chunk-EMIHDNB7-DdMG3soi.js";import"./plus-mini-Ffl9j30L.js";import"./triangles-mini-D7b-TRWS.js";import"./chunk-PWBTCXBJ-CmQc7-so.js";import"./format-3Ss4Ci4V.js";import"./index-DCgFmjMu.js";import"./prompt-iwSKyxmR.js";import"./index.esm-BZ1Mw3iw.js";var H=dt(),It=l=>{const{t:o}=L();return j.useMemo(()=>[H.display({id:"select",header:({table:n})=>e.jsx(ie,{checked:n.getIsSomePageRowsSelected()?"indeterminate":n.getIsAllPageRowsSelected(),onCheckedChange:t=>n.toggleAllPageRowsSelected(!!t)}),cell:({row:n})=>{const t=n.getCanSelect();return e.jsx(ie,{disabled:!t,checked:n.getIsSelected(),onCheckedChange:d=>n.toggleSelected(!!d),onClick:d=>{d.stopPropagation()}})}}),H.display({id:"product",header:()=>e.jsx(Je,{}),cell:({row:n})=>e.jsx(Ge,{product:{thumbnail:n.original.thumbnail,title:n.original.product_title}})}),H.accessor("variant.sku",{header:o("fields.sku"),cell:({getValue:n})=>n()||"-"}),H.accessor("variant.title",{header:o("fields.variant")}),H.accessor("quantity",{header:()=>e.jsx("div",{className:"flex size-full items-center overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:o("fields.quantity")})}),cell:({getValue:n,row:t})=>ce(t.original)}),H.accessor("refundable_total",{header:()=>e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:o("fields.price")})}),cell:({getValue:n})=>{const t=n()||0,d=z(t,l);return e.jsx("div",{className:"flex size-full items-center justify-end overflow-hidden text-right",children:e.jsx("span",{className:"truncate",children:d})})}})],[o,l])},St=()=>{const{t:l}=L();return[{key:"returnable_quantity",label:l("orders.returns.returnableQuantityLabel"),type:"number"},{key:"refundable_amount",label:l("orders.returns.refundableAmountLabel"),type:"number"},{key:"created_at",label:l("fields.createdAt"),type:"date"},{key:"updated_at",label:l("fields.updatedAt"),type:"date"}]},Ct=({pageSize:l=50,prefix:o})=>{const n=pt(["q","offset","order","created_at","updated_at","returnable_quantity","refundable_amount"],o),{offset:t,created_at:d,updated_at:u,refundable_amount:c,returnable_quantity:g,...b}=n;return{searchParams:{...b,limit:l,offset:t?Number(t):0,created_at:d?JSON.parse(d):void 0,updated_at:u?JSON.parse(u):void 0,refundable_amount:c?JSON.parse(c):void 0,returnable_quantity:g?JSON.parse(g):void 0},raw:n}},K=50,re="rit",wt=({onSelectionChange:l,selectedItems:o,items:n,currencyCode:t})=>{const{t:d}=L(),[u,c]=j.useState(o.reduce((x,v)=>(x[v]=!0,x),{})),g=x=>{const v=typeof x=="function"?x(u):x;c(v),l(Object.keys(v))},{searchParams:b,raw:p}=Ct({pageSize:K,prefix:re}),y=j.useMemo(()=>{const{order:x,offset:v,limit:k,q:A,created_at:B,updated_at:O,refundable_amount:U,returnable_quantity:$}=b;let N=n;if(A&&(N=N.filter(P=>{var M;return P.product_title.toLowerCase().includes(A.toLowerCase())||P.variant_title.toLowerCase().includes(A.toLowerCase())||((M=P.variant_sku)==null?void 0:M.toLowerCase().includes(A.toLowerCase()))})),x){const P=x[0]==="-"?"desc":"asc",M=x.replace("-","");N=Rt(N,M,P)}return B&&(N=ae(N,B,"created_at")),O&&(N=ae(N,O,"updated_at")),$&&(N=oe(N,$,"returnable_quantity",t)),U&&(N=oe(N,U,"refundable_amount",t)),N.slice(v,v+k)},[n,t,b]),R=It(t),I=St(),{table:_}=ct({data:y,columns:R,count:y.length,enablePagination:!0,getRowId:x=>x.id,pageSize:K,enableRowSelection:x=>ce(x.original)>0,rowSelection:{state:u,updater:g}});return e.jsx("div",{className:"flex size-full flex-col overflow-hidden",children:e.jsx(ut,{table:_,columns:R,pageSize:K,count:y.length,filters:I,pagination:!0,layout:"fill",search:!0,orderBy:[{key:"product_title",label:d("fields.product")},{key:"variant_title",label:d("fields.variant")},{key:"sku",label:d("fields.sku")},{key:"returnable_quantity",label:d("orders.fields.returnableQuantity")},{key:"refundable_amount",label:d("orders.fields.refundableAmount")}],prefix:re,queryObject:p})})},Rt=(l,o,n)=>l.sort((t,d)=>{let u,c;return o==="product_title"?(u=t.product_title,c=d.product_title):o==="variant_title"?(u=t.variant_title,c=d.variant_title):o==="sku"?(u=t.variant_sku,c=d.variant_sku):o==="returnable_quantity"?(u=t.quantity-(t.returned_quantity||0),c=d.quantity-(d.returned_quantity||0)):o==="refundable_amount"&&(u=t.refundable||0,c=d.refundable||0),u<c?n==="asc"?-1:1:u>c?n==="asc"?1:-1:0}),ae=(l,o,n)=>{const{gt:t,gte:d,lt:u,lte:c}=o;return l.filter(g=>{const b=new Date(g[n]);let p=!0;return t&&(p=p&&b>new Date(t)),d&&(p=p&&b>=new Date(d)),u&&(p=p&&b<new Date(u)),c&&(p=p&&b<=new Date(c)),p})},le={eq:void 0,gt:void 0,gte:void 0,lt:void 0,lte:void 0},oe=(l,o,n,t)=>{const{eq:d,gt:u,lt:c,gte:g,lte:b}=typeof o=="object"?{...le,...o}:{...le,eq:o};return l.filter(p=>{const y=p.quantity-(p.returned_quantity||0),R=z(p.refundable||0,t),I=n==="returnable_quantity"?y:R;if(d)return I===d;let _=!0;return u&&(_=_&&I>u),g&&(_=_&&I>=g),c&&(_=_&&I<c),b&&(_=_&&I<=b),_})};function qt({item:l,previewItem:o,currencyCode:n,form:t,onRemove:d,onUpdate:u,index:c}){const{t:g}=L(),{return_reasons:b=[]}=rt({fields:"+label"}),p=t.watch(`items.${c}`),y=typeof p.reason_id=="string",R=typeof p.note=="string";return e.jsxs("div",{className:"bg-ui-bg-subtle shadow-elevation-card-rest my-2 rounded-xl ",children:[e.jsxs("div",{className:"flex flex-col items-center gap-x-2 gap-y-2 border-b p-3 text-sm md:flex-row",children:[e.jsxs("div",{className:"flex flex-1 items-center gap-x-3",children:[e.jsx(at,{src:l.thumbnail}),e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{children:[e.jsxs(V,{className:"txt-small",as:"span",weight:"plus",children:[l.title," "]}),l.variant_sku&&e.jsxs("span",{children:["(",l.variant_sku,")"]})]}),e.jsx(V,{as:"div",className:"text-ui-fg-subtle txt-small",children:l.product_title})]})]}),e.jsxs("div",{className:"flex flex-1 justify-between",children:[e.jsxs("div",{className:"flex flex-grow items-center gap-2",children:[e.jsx(m.Field,{control:t.control,name:`items.${c}.quantity`,render:({field:I})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(se,{className:"bg-ui-bg-base txt-small w-[67px] rounded-lg",min:1,max:l.quantity,type:"number",...I,onChange:_=>{const x=_.target.value,v=x===""?null:Number(x);I.onChange(v),v&&u({quantity:v})}})}),e.jsx(m.ErrorMessage,{})]})}),e.jsx(V,{className:"txt-small text-ui-fg-subtle",children:g("fields.qty")})]}),e.jsx("div",{className:"text-ui-fg-subtle txt-small mr-2 flex flex-shrink-0",children:e.jsx(Me,{currencyCode:n,amount:o.return_requested_total})}),e.jsx(lt,{groups:[{actions:[!y&&{label:g("actions.addReason"),onClick:()=>t.setValue(`items.${c}.reason_id`,""),icon:e.jsx(ot,{})},!R&&{label:g("actions.addNote"),onClick:()=>t.setValue(`items.${c}.note`,""),icon:e.jsx(yt,{})},{label:g("actions.remove"),onClick:d,icon:e.jsx(vt,{})}].filter(Boolean)}]})]})]}),e.jsxs(e.Fragment,{children:[y&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:g("orders.returns.reason")}),e.jsx(m.Hint,{className:"!mt-1",children:g("orders.returns.reasonHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`items.${c}.reason_id`,render:({field:{ref:I,value:_,onChange:x,...v}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(Y,{className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover",value:_,onChange:k=>{u({reason_id:k}),x(k)},...v,options:b.map(k=>({label:k.label,value:k.id}))})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(W,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{u({reason_id:null}),t.setValue(`items.${c}.reason_id`,null)},children:e.jsx(ne,{className:"text-ui-fg-muted"})})]})]}),R&&e.jsxs("div",{className:"grid grid-cols-1 gap-2 p-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:g("orders.returns.note")}),e.jsx(m.Hint,{className:"!mt-1",children:g("orders.returns.noteHint")})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"flex-grow",children:e.jsx(m.Field,{control:t.control,name:`items.${c}.note`,render:({field:{ref:I,onChange:_,...x}})=>e.jsxs(m.Item,{children:[e.jsx(m.Control,{children:e.jsx(se,{onChange:_,...x,onBlur:()=>u({internal_note:x.value}),className:"bg-ui-bg-field-component hover:bg-ui-bg-field-component-hover"})}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx(W,{type:"button",className:"flex-shrink",variant:"transparent",onClick:()=>{t.setValue(`items.${c}.note`,{shouldDirty:!0,shouldTouch:!0}),u({internal_note:null})},children:e.jsx(ne,{className:"text-ui-fg-muted"})})]})]})]})]})}var kt=q.object({items:q.array(q.object({item_id:q.string(),quantity:q.number(),reason_id:q.string().optional().nullable(),note:q.string().optional().nullable()})),location_id:q.string().optional(),option_id:q.string(),send_notification:q.boolean().optional(),receive_now:q.boolean().optional()}),de=[],Pt=({order:l,preview:o,activeReturn:n})=>{const{t}=L(),{handleSuccess:d}=xt(),u=j.useMemo(()=>new Map((l.items||[]).map(s=>[s.id,s])),[l.items]),c=j.useMemo(()=>o.items.filter(s=>{var i;return!!((i=s.actions)!=null&&i.find(r=>r.return_id===n.id))}),[o.items]),g=j.useMemo(()=>new Map(c.map(s=>[s.id,s])),[c]),{setIsOpen:b}=ht(),[p,y]=j.useState(!1),[R,I]=j.useState(0),[_,x]=j.useState({}),{stock_locations:v=[]}=Ye({limit:999}),{shipping_options:k=[]}=gt({limit:999,fields:"*prices,+service_zone.fulfillment_set.location.id"}),{mutateAsync:A,isPending:B}=He(n.id,l.id),{mutateAsync:O,isPending:U}=Le(n.id,l.id),{mutateAsync:$,isPending:N}=Fe(n.id,l.id),{mutateAsync:P,isPending:M}=ze(n.id,l.id),{mutateAsync:ue,isPending:me}=Ve(n.id,l.id),{mutateAsync:pe,isPending:fe}=Be(n.id,l.id),{mutateAsync:xe,isPending:he}=Oe(n.id,l.id),{mutateAsync:ge,isPending:_e}=Ue(n.id,l.id),{mutateAsync:be,isPending:je}=$e(n.id,l.id),ye=B||U||M||me||fe||he||_e||je||N,C=et({defaultValues:()=>{const s=o.shipping_methods.find(i=>{var r;return!!((r=i.actions)!=null&&r.find(a=>a.action==="SHIPPING_ADD"))});return Promise.resolve({items:c.map(i=>{var r,a,f,h,S;return{item_id:i.id,quantity:i.detail.return_requested_quantity,note:(a=(r=i.actions)==null?void 0:r.find(D=>D.action==="RETURN_ITEM"))==null?void 0:a.internal_note,reason_id:(S=(h=(f=i.actions)==null?void 0:f.find(D=>D.action==="RETURN_ITEM"))==null?void 0:h.details)==null?void 0:S.reason_id}}),option_id:s?s.shipping_option_id:"",location_id:n==null?void 0:n.location_id,send_notification:!1})},resolver:tt(kt)}),{fields:w,append:ve,remove:Ne,update:Ie}=st({name:"items",control:C.control});j.useEffect(()=>{const s={};c.forEach(i=>{var a,f;const r=w.findIndex(h=>h.item_id===i.id);if(i.detail.return_requested_quantity)if(s[i.id]=!0,r>-1){if(w[r].quantity!==i.detail.return_requested_quantity){const h=(a=i.actions)==null?void 0:a.find(S=>S.action==="RETURN_ITEM");Ie(r,{...w[r],quantity:i.detail.return_requested_quantity,note:h==null?void 0:h.internal_note,reason_id:(f=h==null?void 0:h.details)==null?void 0:f.reason_id})}}else ve({item_id:i.id,quantity:i.detail.return_requested_quantity})}),w.forEach((i,r)=>{i.item_id in s||Ne(r)})},[c]),j.useEffect(()=>{var i;const s=(i=o.shipping_methods)==null?void 0:i.find(r=>{var a;return!!((a=r.actions)!=null&&a.find(f=>f.action==="SHIPPING_ADD"))});s?C.setValue("option_id",s.shipping_option_id):C.setValue("option_id","")},[o.shipping_methods]);const Q=!w.length,T=C.watch("location_id"),Se=C.watch("option_id"),Ce=_t(),we=C.handleSubmit(async s=>{try{if(!await Ce({title:t("general.areYouSure"),description:t("orders.returns.confirmText"),confirmText:t("actions.continue"),cancelText:t("actions.cancel"),variant:"confirmation"}))return;await A({no_notification:!s.send_notification}),d()}catch(i){J.error(t("general.error"),{description:i.message,dismissLabel:t("actions.close")})}}),Re=()=>{xe({items:de.map(s=>({id:s,quantity:1}))}),b("items",!1)},qe=async s=>{await $({location_id:s})},ke=async s=>{const i=o.shipping_methods.map(r=>{var a,f;return(f=(a=r.actions)==null?void 0:a.find(h=>h.action==="SHIPPING_ADD"))==null?void 0:f.id}).filter(Boolean).map(pe);await Promise.all(i),s&&await P({shipping_option_id:s})};j.useEffect(()=>{p&&document.getElementById("js-shipping-input").focus()},[p]),j.useEffect(()=>{C.setValue("location_id",(n==null?void 0:n.location_id)||"")},[n]);const Pe=j.useMemo(()=>T?!w.map(i=>{var a,f;const r=u.get(i.item_id);return!(r!=null&&r.variant_id)||!((a=r.variant)!=null&&a.manage_inventory)?!0:(f=_[r.variant_id])==null?void 0:f.find(h=>h.location_id===T)}).every(Boolean):!1,[w,_,T]);j.useEffect(()=>{(async()=>{const i={};return w.length&&(await Promise.all(w.map(async r=>{const a=u.get(r.item_id);if(a.variant_id)return await it.admin.product.retrieveVariant(a.product_id,a.variant_id,{fields:"*inventory,*inventory.location_levels"})}))).filter(r=>r==null?void 0:r.variant).forEach(r=>{var h;const{variant:a}=r,f=(h=a.inventory[0])==null?void 0:h.location_levels;f&&(i[a.id]=f)}),i})().then(i=>{x(i)})},[w]);const X=o.return_requested_total,Ee=j.useMemo(()=>{const s=o.shipping_methods.find(i=>{var r;return!!((r=i.actions)!=null&&r.find(a=>a.action==="SHIPPING_ADD"))});return(s==null?void 0:s.total)||0},[o.shipping_methods]);return e.jsx(E.Form,{form:C,onClose:s=>{s||O()},children:e.jsxs(ft,{onSubmit:we,className:"flex h-full flex-col",children:[e.jsx(E.Header,{}),e.jsx(E.Body,{className:"flex size-full justify-center overflow-y-auto",children:e.jsxs("div",{className:"mt-16 w-[720px] max-w-[100%] px-4 md:p-0",children:[e.jsx(te,{level:"h1",children:t("orders.returns.create")}),e.jsxs("div",{className:"mt-8 flex items-center justify-between",children:[e.jsx(te,{level:"h2",children:t("orders.returns.inbound")}),e.jsxs(F,{id:"items",children:[e.jsx(F.Trigger,{asChild:!0,children:e.jsx("a",{className:"focus-visible:shadow-borders-focus transition-fg txt-compact-small-plus cursor-pointer text-blue-500 outline-none hover:text-blue-400",children:t("actions.addItems")})}),e.jsxs(F.Content,{children:[e.jsx(F.Header,{}),e.jsx(wt,{items:l.items,selectedItems:w.map(s=>s.item_id),currencyCode:l.currency_code,onSelectionChange:s=>de=s}),e.jsx(F.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(E.Close,{asChild:!0,children:e.jsx(G,{type:"button",variant:"secondary",size:"small",children:t("actions.cancel")})}),e.jsx(G,{type:"submit",variant:"primary",size:"small",role:"button",onClick:()=>Re(),children:t("actions.save")},"submit-button")]})})})]})]})]}),Q&&e.jsx("div",{style:{background:"repeating-linear-gradient(-45deg, rgb(212, 212, 216, 0.15), rgb(212, 212, 216,.15) 10px, transparent 10px, transparent 20px)"},className:"bg-ui-bg-field mt-4 block h-[56px] w-full rounded-lg border border-dashed"}),w.filter(s=>!!g.get(s.item_id)).map((s,i)=>e.jsx(qt,{item:u.get(s.item_id),previewItem:g.get(s.item_id),currencyCode:l.currency_code,form:C,onRemove:()=>{var a,f,h;const r=(h=(f=(a=c.find(S=>S.id===s.item_id))==null?void 0:a.actions)==null?void 0:f.find(S=>S.action==="RETURN_ITEM"))==null?void 0:h.id;r&&ge(r)},onUpdate:r=>{var f,h;const a=(h=(f=c.find(S=>S.id===s.item_id))==null?void 0:f.actions)==null?void 0:h.find(S=>S.action==="RETURN_ITEM");a&&be({...r,actionId:a.id},{onError:S=>{var D,ee;(D=a.details)!=null&&D.quantity&&r.quantity&&C.setValue(`items.${i}.quantity`,(ee=a.details)==null?void 0:ee.quantity),J.error(S.message)}})},index:i},s.id)),!Q&&e.jsxs("div",{className:"mt-8 flex flex-col gap-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m.Label,{children:t("orders.returns.location")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.locationHint")})]}),e.jsx(m.Field,{control:C.control,name:"location_id",render:({field:{value:s,onChange:i,...r}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(Y,{value:s,onChange:a=>{i(a),qe(a)},...r,options:(v??[]).map(a=>({label:a.name,value:a.id}))})})})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-2 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsxs(m.Label,{children:[t("orders.returns.inboundShipping"),e.jsxs(V,{size:"small",leading:"compact",className:"text-ui-fg-muted ml-1 inline",children:["(",t("fields.optional"),")"]})]}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.inboundShippingHint")})]}),e.jsx(m.Field,{control:C.control,name:"option_id",render:({field:{value:s,onChange:i,...r}})=>e.jsx(m.Item,{children:e.jsx(m.Control,{children:e.jsx(Y,{allowClear:!0,value:s,onChange:a=>{i(a),ke(a)},...r,options:(k??[]).filter(a=>(T?a.service_zone.fulfillment_set.location.id===T:!0)&&!!a.rules.find(f=>f.attribute==="is_return"&&f.value==="true")).map(a=>({label:a.name,value:a.id})),disabled:!T,noResultsPlaceholder:e.jsx(Ae,{})})})})})]})]}),Pe&&e.jsxs(Nt,{variant:"warning",dismissible:!0,className:"mt-4 p-5",children:[e.jsx("div",{className:"text-ui-fg-subtle txt-small pb-2 font-medium leading-[20px]",children:t("orders.returns.noInventoryLevel")}),e.jsx(V,{className:"text-ui-fg-subtle txt-small leading-normal",children:t("orders.returns.noInventoryLevelDesc")})]}),e.jsxs("div",{className:"mt-8 border-y border-dotted py-4",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.returnTotal")}),e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:z(X&&-1*X,l.currency_code)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"txt-small text-ui-fg-subtle",children:t("orders.returns.inboundShipping")}),e.jsxs("span",{className:"txt-small text-ui-fg-subtle flex items-center",children:[!p&&e.jsx(W,{onClick:()=>y(!0),variant:"transparent",className:"text-ui-fg-muted",disabled:Q||!Se,children:e.jsx(bt,{})}),p?e.jsx(jt,{id:"js-shipping-input",onBlur:()=>{let s;o.shipping_methods.forEach(i=>{if(i.actions)for(const r of i.actions)r.action==="SHIPPING_ADD"&&(s=r.id)}),s&&ue({actionId:s,custom_amount:typeof R=="string"?null:R}),y(!1)},symbol:mt[l.currency_code.toUpperCase()].symbol_native,code:l.currency_code,onValueChange:s=>I(s?parseFloat(s):""),value:R,disabled:Q}):z(Ee,l.currency_code)]})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-between border-t border-dotted pt-4",children:[e.jsx("span",{className:"txt-small font-medium",children:t("orders.returns.estDifference")}),e.jsx("span",{className:"txt-small font-medium",children:z(o.summary.pending_difference,l.currency_code)})]})]}),e.jsx("div",{className:"bg-ui-bg-field mt-8 rounded-lg border py-2 pl-2 pr-4",children:e.jsx(m.Field,{control:C.control,name:"send_notification",render:({field:{onChange:s,value:i,...r}})=>e.jsxs(m.Item,{children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(m.Control,{className:"mr-4 self-start",children:e.jsx(nt,{className:"mt-[2px]",checked:!!i,onCheckedChange:s,...r})}),e.jsxs("div",{className:"block",children:[e.jsx(m.Label,{children:t("orders.returns.sendNotification")}),e.jsx(m.Hint,{className:"!mt-1",children:t("orders.returns.sendNotificationHint")})]})]}),e.jsx(m.ErrorMessage,{})]})})}),e.jsx("div",{className:"p-8"})]})}),e.jsx(E.Footer,{children:e.jsx("div",{className:"flex w-full items-center justify-end gap-x-4",children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(E.Close,{asChild:!0,children:e.jsx(G,{type:"button",variant:"secondary",size:"small",children:t("orders.returns.cancel.title")})}),e.jsx(G,{type:"submit",variant:"primary",size:"small",isLoading:ye,children:t("orders.returns.confirm")},"submit-button")]})})})]})})},Z=!1,ps=()=>{const{id:l}=Xe(),o=Ke(),{t:n}=L(),{order:t}=Ze(l,{fields:Qe}),{order:d}=We(l,void 0,{}),[u,c]=j.useState(),{mutateAsync:g}=Te(t.id),{return:b}=De(u,void 0,{enabled:!!u});return j.useEffect(()=>{async function p(){if(!(Z||!d)){if(d.order_change){d.order_change.change_type==="return_request"?c(d.order_change.return_id):(o(`/orders/${t.id}`,{replace:!0}),J.error(n("orders.returns.activeChangeError")));return}Z=!0;try{const y=await g({order_id:t.id});c(y.id)}catch(y){o(`/orders/${t.id}`,{replace:!0}),J.error(y.message)}finally{Z=!1}}}p()},[d]),e.jsx(E,{children:b&&d&&t&&e.jsx(Pt,{order:t,activeReturn:b,preview:d})})};export{ps as Component};
