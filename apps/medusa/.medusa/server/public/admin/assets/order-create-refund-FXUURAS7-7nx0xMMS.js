import{a as L}from"./chunk-DDV2HJEV-BcbJw9iX.js";import{f as P}from"./chunk-OV5NMSY6-CzJZ0JaW.js";import{D as I}from"./chunk-7I5DQGWY-CwOWioty.js";import{g as A}from"./chunk-PDWBYQOW-Dmlh1vBq.js";import{c as w}from"./chunk-MWVM4TYO-bKUcYSnf.js";import{K as N}from"./chunk-6HTZNHPT-0pp2n7Qw.js";import{b as m,u as V}from"./chunk-ZCO6EK4W-DiFonNoY.js";import{b as S,Z as D,b1 as M,dp as z,j as e,H as O,u as B,a8 as H,r as R,af as $,ag as K,t as C,y as U,w as o,T as k,B as v,a9 as q,ab as g,am as Z}from"./index-D8_C337_.js";import{a as G}from"./chunk-4GJJIXM6-BaBDMFQo.js";import{f as J}from"./index.esm-C46Fda3W.js";import{S as l}from"./select-Dpe4hrIK.js";import{C as Q}from"./currency-input-BZiKSNAN.js";import"./chunk-K7S5TX6I-G7sICbFu.js";import"./chunk-7DXVXBSA-u0lQbI_F.js";import"./document-text-hXu1p5lP.js";import"./arrow-down-right-mini-DWSQrd0R.js";import"./use-prompt-Cp1uXca5.js";import"./prompt-D1CRywiH.js";import"./x-circle-BoImElHK.js";import"./Trans-C2UT8Ilp.js";import"./status-badge-BMu0LlW-.js";import"./format-BT1SBArb.js";import"./check-CQfMD251.js";import"./triangles-mini-DSoa5oMY.js";var W=q({amount:g().or(Z()),refund_reason_id:g().nullish(),note:g().optional()}),X=({order:t,refundReasons:y})=>{const{t:n}=S(),{handleSuccess:u}=V(),x=B(),[h]=H(),j=h.get("paymentId"),_=L(t),s=_.find(r=>r.id===j),b=(s==null?void 0:s.amount)||0,f=R.useMemo(()=>w[t.currency_code.toUpperCase()],[t.currency_code]),i=$({defaultValues:{amount:b,note:""},resolver:K(W)});R.useEffect(()=>{const r=t.summary.pending_difference,a=(s==null?void 0:s.amount)||0,c=r<0?Math.min(r,a):a,p=c<0?c*-1:c;i.setValue("amount",p)},[s]);const{mutateAsync:F,isPending:E}=G(t.id,s==null?void 0:s.id),T=i.handleSubmit(async r=>{await F({amount:parseFloat(r.amount),refund_reason_id:r.refund_reason_id,note:r.note},{onSuccess:()=>{C.success(n("orders.payment.refundPaymentSuccess",{amount:P(r.amount,s==null?void 0:s.currency_code)})),u()},onError:a=>{C.error(a.message)}})});return e.jsx(m.Form,{form:i,children:e.jsxs(N,{onSubmit:T,className:"flex size-full flex-col overflow-hidden",children:[e.jsx(m.Body,{className:"flex-1 overflow-auto",children:e.jsxs("div",{className:"flex flex-col gap-y-4",children:[e.jsxs(l,{value:s==null?void 0:s.id,onValueChange:r=>{x(`/orders/${t.id}/refund?paymentId=${r}`,{replace:!0})},children:[e.jsx(U,{className:"txt-compact-small mb-[-6px] font-sans font-medium",children:n("orders.payment.selectPaymentToRefund")}),e.jsx(l.Trigger,{children:e.jsx(l.Value,{placeholder:n("orders.payment.selectPaymentToRefund")})}),e.jsx(l.Content,{children:_.map(r=>{const a=r.refunds.reduce((c,p)=>p.amount+c,0);return e.jsxs(l.Item,{value:r.id,disabled:!!r.canceled_at||a>=r.amount,children:[e.jsxs("span",{children:[A(r.amount,r.currency_code)," - "]}),e.jsx("span",{children:r.provider_id}),e.jsxs("span",{children:[" - (",r.id.replace("pay_",""),")"]})]},r.id)})})]}),e.jsx(o.Field,{control:i.control,name:"amount",rules:{required:!0,min:0,max:b},render:({field:{onChange:r,...a}})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:n("fields.amount")}),e.jsx(o.Control,{children:e.jsx(Q,{...a,min:0,placeholder:J({value:"0",decimalScale:f.decimal_digits}),decimalScale:f.decimal_digits,symbol:f.symbol_native,code:f.code,value:a.value,onValueChange:(c,p,d)=>r(d!=null&&d.value?d==null?void 0:d.value:""),autoFocus:!0})}),e.jsx(o.ErrorMessage,{})]})}),e.jsx(o.Field,{control:i.control,name:"note",render:({field:r})=>e.jsxs(o.Item,{children:[e.jsx(o.Label,{children:n("fields.note")}),e.jsx(o.Control,{children:e.jsx(k,{...r})}),e.jsx(o.ErrorMessage,{})]})})]})}),e.jsx(m.Footer,{children:e.jsxs("div",{className:"flex items-center justify-end gap-x-2",children:[e.jsx(m.Close,{asChild:!0,children:e.jsx(v,{variant:"secondary",size:"small",children:n("actions.cancel")})}),e.jsx(v,{isLoading:E,type:"submit",variant:"primary",size:"small",disabled:!!Object.keys(i.formState.errors||{}).length,children:n("actions.save")})]})})]})})},Ce=()=>{const{t}=S(),y=D(),{order:n}=M(y.id,{fields:I}),{refund_reasons:u,isLoading:x,isError:h,error:j}=z();if(h)throw j;return e.jsxs(m,{children:[e.jsx(m.Header,{children:e.jsx(O,{children:t("orders.payment.createRefund")})}),n&&!x&&u&&e.jsx(X,{order:n,refundReasons:u})]})};export{Ce as Component};
